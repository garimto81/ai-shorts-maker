<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFmpeg 이미지 전환 효과 테스트</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid rgba(255,255,255,0.2); 
            border-radius: 8px; 
            background: rgba(255,255,255,0.05);
        }
        .effect-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .effect-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            background: linear-gradient(45deg, #667eea, #764ba2); 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover { 
            transform: translateY(-2px);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .result { 
            margin-top: 15px; 
            padding: 15px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 8px; 
            max-height: 400px;
            overflow-y: auto;
        }
        .success { 
            background: rgba(76, 175, 80, 0.2); 
            color: #a5d6a7; 
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        .error { 
            background: rgba(244, 67, 54, 0.2); 
            color: #ef9a9a; 
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        .loading {
            background: rgba(255, 193, 7, 0.2);
            color: #fff3c4;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        .code-block {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .preview-area {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .preview-video {
            flex: 1;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        video {
            max-width: 100%;
            border-radius: 5px;
        }
        .upload-area {
            border: 2px dashed rgba(255,255,255,0.3);
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
        }
        .image-preview {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            overflow-x: auto;
            padding: 10px;
        }
        .image-preview img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎬 FFmpeg 이미지 전환 효과 테스트 시스템</h1>
        <p>다양한 FFmpeg 전환 효과를 테스트하고 비교할 수 있는 도구입니다.</p>
        
        <!-- 이미지 업로드 -->
        <div class="test-section">
            <h3>📷 테스트 이미지 업로드</h3>
            <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                <h4>클릭하여 이미지 선택</h4>
                <p>최소 3장 이상의 이미지를 선택해주세요</p>
                <input type="file" id="imageInput" multiple accept="image/*" style="display: none;" onchange="handleImageUpload()">
            </div>
            <div id="imagePreview" class="image-preview"></div>
            <div id="uploadStatus" class="result"></div>
        </div>

        <!-- 기본 전환 효과들 -->
        <div class="test-section">
            <h3>🎨 기본 전환 효과</h3>
            <div class="effect-grid">
                <div class="effect-card">
                    <h4>🔄 크로스페이드</h4>
                    <p>두 이미지가 부드럽게 섞이며 전환</p>
                    <button onclick="testTransition('crossfade')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=fade:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>⬅️ 슬라이드 (좌)</h4>
                    <p>새 이미지가 왼쪽에서 밀고 들어옴</p>
                    <button onclick="testTransition('slideleft')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=slideleft:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>➡️ 슬라이드 (우)</h4>
                    <p>새 이미지가 오른쪽에서 밀고 들어옴</p>
                    <button onclick="testTransition('slideright')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=slideright:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>⬆️ 슬라이드 (상)</h4>
                    <p>새 이미지가 위에서 밀고 들어옴</p>
                    <button onclick="testTransition('slideup')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=slideup:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>⬇️ 슬라이드 (하)</h4>
                    <p>새 이미지가 아래에서 밀고 들어옴</p>
                    <button onclick="testTransition('slidedown')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=slidedown:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>🔳 와이프 (좌)</h4>
                    <p>직선으로 왼쪽에서 오른쪽으로 전환</p>
                    <button onclick="testTransition('wipeleft')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=wipeleft:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>🎯 원형 확장</h4>
                    <p>중앙에서 원형으로 확장</p>
                    <button onclick="testTransition('circleopen')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=circleopen:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>📐 대각선</h4>
                    <p>대각선 방향으로 전환</p>
                    <button onclick="testTransition('diagtl')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=diagtl:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>🌀 회전</h4>
                    <p>회전하며 전환</p>
                    <button onclick="testTransition('rotate')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=rotate:duration=1"</div>
                </div>

                <div class="effect-card">
                    <h4>🎭 디졸브</h4>
                    <p>픽셀이 무작위로 섞이며 전환</p>
                    <button onclick="testTransition('dissolve')">테스트</button>
                    <div class="code-block">-filter_complex "xfade=transition=dissolve:duration=1"</div>
                </div>
            </div>
        </div>

        <!-- 고급 효과들 -->
        <div class="test-section">
            <h3>✨ 고급 전환 효과</h3>
            <div class="effect-grid">
                <div class="effect-card">
                    <h4>🔍 줌 + 페이드</h4>
                    <p>확대하며 페이드 전환</p>
                    <button onclick="testTransition('zoomfade')">테스트</button>
                    <div class="code-block">Ken Burns 효과 + 크로스페이드</div>
                </div>

                <div class="effect-card">
                    <h4>🎢 Ken Burns</h4>
                    <p>확대/축소 + 팬 효과</p>
                    <button onclick="testTransition('kenburns')">테스트</button>
                    <div class="code-block">zoompan=z='zoom+0.002':x=iw/2:y=ih/2</div>
                </div>

                <div class="effect-card">
                    <h4>📺 픽셀화</h4>
                    <p>픽셀 모자이크 효과</p>
                    <button onclick="testTransition('pixelize')">테스트</button>
                    <div class="code-block">scale=iw/20:ih/20:flags=neighbor, scale=iw*20:ih*20:flags=neighbor</div>
                </div>

                <div class="effect-card">
                    <h4>🌈 블러 전환</h4>
                    <p>블러 효과와 함께 전환</p>
                    <button onclick="testTransition('blur')">테스트</button>
                    <div class="code-block">boxblur=5:1, xfade=transition=fade</div>
                </div>

                <div class="effect-card">
                    <h4>⚡ 글리치</h4>
                    <p>디지털 글리치 효과</p>
                    <button onclick="testTransition('glitch')">테스트</button>
                    <div class="code-block">noise=alls=20:allf=t+u, datascope</div>
                </div>

                <div class="effect-card">
                    <h4>🎨 컬러 전환</h4>
                    <p>색상 변화와 함께 전환</p>
                    <button onclick="testTransition('colorshift')">테스트</button>
                    <div class="code-block">colorchannelmixer, hue=h=t*100</div>
                </div>
            </div>
        </div>

        <!-- 복합 효과 테스트 -->
        <div class="test-section">
            <h3>🎪 복합 효과 테스트</h3>
            <button onclick="testComplexTransition('cinematic')">🎬 영화적 전환</button>
            <button onclick="testComplexTransition('dynamic')">⚡ 다이나믹 전환</button>
            <button onclick="testComplexTransition('elegant')">✨ 우아한 전환</button>
            <button onclick="testComplexTransition('energetic')">🔥 에너지틱 전환</button>
        </div>

        <!-- 결과 미리보기 -->
        <div class="test-section">
            <h3>📺 결과 미리보기</h3>
            <div class="preview-area">
                <div class="preview-video">
                    <h4>생성된 비디오</h4>
                    <div id="videoPreview">
                        <p>전환 효과를 테스트하면 여기에 결과가 표시됩니다.</p>
                    </div>
                </div>
                <div class="preview-video">
                    <h4>처리 로그</h4>
                    <div id="processingLog" class="result">
                        <p>처리 과정이 여기에 표시됩니다.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 효과 비교 -->
        <div class="test-section">
            <h3>⚖️ 효과 비교</h3>
            <button onclick="compareAllEffects()">모든 효과 한번에 비교</button>
            <div id="comparisonResult" class="result"></div>
        </div>
    </div>

    <script>
        let uploadedImages = [];
        let currentTest = null;

        function handleImageUpload() {
            const input = document.getElementById('imageInput');
            const preview = document.getElementById('imagePreview');
            const status = document.getElementById('uploadStatus');
            
            uploadedImages = Array.from(input.files);
            
            if (uploadedImages.length < 3) {
                status.className = 'result error';
                status.textContent = '❌ 최소 3장의 이미지가 필요합니다.';
                return;
            }

            // 이미지 미리보기 생성
            preview.innerHTML = '';
            uploadedImages.forEach((file, index) => {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.alt = `Image ${index + 1}`;
                preview.appendChild(img);
            });

            status.className = 'result success';
            status.innerHTML = `✅ ${uploadedImages.length}장의 이미지가 업로드되었습니다.`;
        }

        async function testTransition(transitionType) {
            if (uploadedImages.length < 3) {
                alert('먼저 이미지를 업로드해주세요.');
                return;
            }

            const logArea = document.getElementById('processingLog');
            logArea.className = 'result loading';
            logArea.innerHTML = `🔄 ${transitionType} 전환 효과 테스트 중...`;

            try {
                const formData = new FormData();
                
                // 처음 3장만 사용
                for (let i = 0; i < Math.min(3, uploadedImages.length); i++) {
                    formData.append('images', uploadedImages[i]);
                }
                
                formData.append('transitionType', transitionType);
                formData.append('duration', '2'); // 각 이미지당 2초
                formData.append('transitionDuration', '1'); // 전환 효과 1초

                const response = await fetch('/api/test-transitions', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    logArea.className = 'result success';
                    logArea.innerHTML = `
                        ✅ ${transitionType} 효과 생성 완료!<br>
                        📁 파일: ${result.filename}<br>
                        ⏱️ 처리시간: ${result.processingTime}ms<br>
                        🎬 총 길이: ${result.duration}초
                    `;

                    // 비디오 미리보기
                    const videoPreview = document.getElementById('videoPreview');
                    videoPreview.innerHTML = `
                        <video controls width="100%">
                            <source src="/output/${result.filename}" type="video/mp4">
                        </video>
                        <br>
                        <a href="/output/${result.filename}" download="${result.filename}" 
                           style="display: inline-block; padding: 10px 20px; background: linear-gradient(45deg, #4caf50, #45a049); color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">
                           📥 다운로드
                        </a>
                    `;
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                logArea.className = 'result error';
                logArea.innerHTML = `❌ 전환 효과 생성 실패: ${error.message}`;
            }
        }

        async function testComplexTransition(styleType) {
            if (uploadedImages.length < 3) {
                alert('먼저 이미지를 업로드해주세요.');
                return;
            }

            const logArea = document.getElementById('processingLog');
            logArea.className = 'result loading';
            
            const styleDescriptions = {
                cinematic: '영화적 효과 (Ken Burns + 크로스페이드)',
                dynamic: '다이나믹 효과 (줌 + 슬라이드 조합)',
                elegant: '우아한 효과 (디졸브 + 블러)',
                energetic: '에너지틱 효과 (글리치 + 컬러 시프트)'
            };

            logArea.innerHTML = `🔄 ${styleDescriptions[styleType]} 테스트 중...`;

            try {
                const formData = new FormData();
                
                for (let i = 0; i < uploadedImages.length; i++) {
                    formData.append('images', uploadedImages[i]);
                }
                
                formData.append('styleType', styleType);
                formData.append('duration', '3'); // 각 이미지당 3초
                formData.append('transitionDuration', '1.5'); // 전환 효과 1.5초

                const response = await fetch('/api/test-complex-transitions', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    logArea.className = 'result success';
                    logArea.innerHTML = `
                        ✅ ${styleDescriptions[styleType]} 생성 완료!<br>
                        📁 파일: ${result.filename}<br>
                        ⏱️ 처리시간: ${Math.round(result.processingTime/1000)}초<br>
                        🎬 총 길이: ${result.duration}초<br>
                        🎨 사용된 효과: ${result.effects.join(', ')}
                    `;

                    const videoPreview = document.getElementById('videoPreview');
                    videoPreview.innerHTML = `
                        <video controls width="100%">
                            <source src="/output/${result.filename}" type="video/mp4">
                        </video>
                        <br>
                        <a href="/output/${result.filename}" download="${result.filename}" 
                           style="display: inline-block; padding: 10px 20px; background: linear-gradient(45deg, #4caf50, #45a049); color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">
                           📥 다운로드
                        </a>
                    `;
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                logArea.className = 'result error';
                logArea.innerHTML = `❌ 복합 전환 효과 생성 실패: ${error.message}`;
            }
        }

        async function compareAllEffects() {
            if (uploadedImages.length < 3) {
                alert('먼저 이미지를 업로드해주세요.');
                return;
            }

            const result = document.getElementById('comparisonResult');
            result.className = 'result loading';
            result.innerHTML = '🔄 모든 전환 효과 비교 생성 중... (약 5-10분 소요)';

            const effects = ['crossfade', 'slideleft', 'slideright', 'wipeleft', 'circleopen', 'diagtl', 'dissolve'];
            
            try {
                const formData = new FormData();
                
                for (let i = 0; i < Math.min(3, uploadedImages.length); i++) {
                    formData.append('images', uploadedImages[i]);
                }
                
                formData.append('effects', JSON.stringify(effects));

                const response = await fetch('/api/compare-transitions', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.success) {
                    result.className = 'result success';
                    result.innerHTML = `
                        <h4>✅ 모든 전환 효과 비교 완료!</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                            ${data.results.map(r => `
                                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                                    <h5>${r.effect}</h5>
                                    <video controls style="width: 100%; height: 150px;">
                                        <source src="/output/${r.filename}" type="video/mp4">
                                    </video>
                                    <p style="font-size: 12px;">처리시간: ${r.processingTime}ms</p>
                                    <a href="/output/${r.filename}" download="${r.filename}" 
                                       style="display: inline-block; padding: 5px 10px; background: #4caf50; color: white; text-decoration: none; border-radius: 3px; font-size: 12px;">
                                       📥 다운로드
                                    </a>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                result.className = 'result error';
                result.innerHTML = `❌ 비교 생성 실패: ${error.message}`;
            }
        }

        // 페이지 로드시 안내 메시지
        document.addEventListener('DOMContentLoaded', function() {
            const uploadStatus = document.getElementById('uploadStatus');
            uploadStatus.className = 'result';
            uploadStatus.innerHTML = '📌 먼저 테스트할 이미지를 3장 이상 업로드해주세요.';
        });
    </script>
</body>
</html>