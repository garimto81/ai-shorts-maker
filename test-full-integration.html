<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Shorts Maker - ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f0f2f5;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #1a1a1a;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .workflow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .step {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        .step:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.12);
        }
        
        .step h2 {
            color: #2196F3;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-number {
            background: #2196F3;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
        }
        
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .loading {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        
        audio, video {
            width: 100%;
            margin-top: 10px;
            border-radius: 6px;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            background: #2196F3;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pending { background: #999; }
        .status-processing { background: #ff9800; }
        .status-completed { background: #4CAF50; }
        .status-error { background: #f44336; }
        
        .test-samples {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 6px;
        }
        
        .sample-button {
            background: #2196F3;
            margin: 5px;
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
            display: inline-block;
        }
        
        .sample-button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ AI Shorts Maker - ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸</h1>
        
        <div class="workflow">
            <!-- Step 1: ìŠ¤í¬ë¦½íŠ¸ ìƒì„± -->
            <div class="step" id="step1">
                <h2>
                    <span class="step-number">1</span>
                    ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
                </h2>
                
                <div class="form-group">
                    <label for="scriptTitle">ì œëª©</label>
                    <input type="text" id="scriptTitle" value="AIê°€ ë§Œë“œëŠ” ë†€ë¼ìš´ ì‡¼ì¸  ì˜ìƒ">
                </div>
                
                <div class="form-group">
                    <label for="scriptContent">ë‚´ìš©</label>
                    <textarea id="scriptContent">ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ AIë¡œ ë§Œë“  ë†€ë¼ìš´ ì‡¼ì¸  ì˜ìƒì„ ì†Œê°œí•©ë‹ˆë‹¤. ì •ë§ ì‹ ê¸°í•˜ê³  ì¬ë¯¸ìˆëŠ” ê¸°ìˆ ì´ì—ìš”! ì—¬ëŸ¬ë¶„ë„ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹µë‹ˆë‹¤. ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”!</textarea>
                </div>
                
                <div class="form-group">
                    <label for="videoStyle">ë¹„ë””ì˜¤ ìŠ¤íƒ€ì¼</label>
                    <select id="videoStyle">
                        <option value="promotional">í™ë³´ (í™œê¸°ì°¬)</option>
                        <option value="educational">êµìœ¡ (ì¹œê·¼í•œ)</option>
                        <option value="entertainment">ì—”í„°í…Œì¸ë¨¼íŠ¸ (ì‹ ë‚˜ëŠ”)</option>
                        <option value="documentary">ë‹¤íë©˜í„°ë¦¬ (ì°¨ë¶„í•œ)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="generateAudio" checked>
                        í™œê¸°ì°¬ ìŒì„± ìë™ ìƒì„±
                    </label>
                </div>
                
                <button onclick="generateScript()">ìŠ¤í¬ë¦½íŠ¸ ìƒì„±</button>
                
                <div class="test-samples">
                    <h4>í…ŒìŠ¤íŠ¸ ìƒ˜í”Œ:</h4>
                    <button class="sample-button" onclick="loadSample('product')">ì‹ ì œí’ˆ ì†Œê°œ</button>
                    <button class="sample-button" onclick="loadSample('tutorial')">íŠœí† ë¦¬ì–¼</button>
                    <button class="sample-button" onclick="loadSample('event')">ì´ë²¤íŠ¸ í™ë³´</button>
                </div>
                
                <div id="scriptResult" class="result-box" style="display: none;"></div>
            </div>
            
            <!-- Step 2: ìŒì„± í™•ì¸ -->
            <div class="step" id="step2">
                <h2>
                    <span class="step-number">2</span>
                    ìŒì„± í™•ì¸
                </h2>
                
                <div id="audioSection" style="display: none;">
                    <p><strong>ìƒì„±ëœ ìŒì„±:</strong></p>
                    <p id="voiceInfo"></p>
                    <audio id="audioPlayer" controls></audio>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label>ìŒì„± ë§Œì¡±ë„</label>
                        <select id="audioSatisfaction">
                            <option value="perfect">ì™„ë²½í•´ìš”! ğŸ‰</option>
                            <option value="good">ì¢‹ì•„ìš” ğŸ‘</option>
                            <option value="regenerate">ë‹¤ì‹œ ìƒì„±í• ê²Œìš” ğŸ”„</option>
                        </select>
                    </div>
                    
                    <button onclick="regenerateAudio()" id="regenerateBtn" style="display: none;">ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ë¡œ ì¬ìƒì„±</button>
                </div>
                
                <div id="audioStatus" class="loading" style="display: none;">ìŒì„±ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
            </div>
            
            <!-- Step 3: ë¹„ë””ì˜¤ ìƒì„± -->
            <div class="step" id="step3">
                <h2>
                    <span class="step-number">3</span>
                    ë¹„ë””ì˜¤ ìƒì„±
                </h2>
                
                <div class="form-group">
                    <label for="testImages">í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì„ íƒ</label>
                    <select id="testImages">
                        <option value="nature">ìì—° í’ê²½ (5ì¥)</option>
                        <option value="tech">ê¸°ìˆ /IT (5ì¥)</option>
                        <option value="food">ìŒì‹ (5ì¥)</option>
                        <option value="abstract">ì¶”ìƒì  ì´ë¯¸ì§€ (5ì¥)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="videoQuality">ë¹„ë””ì˜¤ í’ˆì§ˆ</label>
                    <select id="videoQuality">
                        <option value="high">ê³ í’ˆì§ˆ (1080p)</option>
                        <option value="medium" selected>ì¤‘ê°„ (720p)</option>
                        <option value="low">ì €í’ˆì§ˆ (540p)</option>
                    </select>
                </div>
                
                <button onclick="generateVideo()" id="generateVideoBtn" disabled>ë¹„ë””ì˜¤ ìƒì„±</button>
                
                <div class="progress-bar" id="videoProgress" style="display: none;">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div id="videoResult" style="display: none;">
                    <video id="videoPlayer" controls></video>
                    <div id="videoInfo"></div>
                </div>
            </div>
        </div>
        
        <!-- ì „ì²´ ìƒíƒœ í‘œì‹œ -->
        <div class="step" style="grid-column: 1 / -1;">
            <h2>ğŸ“Š ì „ì²´ ì§„í–‰ ìƒíƒœ</h2>
            <div id="overallStatus">
                <p><span class="status-indicator status-pending"></span>ìŠ¤í¬ë¦½íŠ¸ ìƒì„±: <span id="scriptStatus">ëŒ€ê¸° ì¤‘</span></p>
                <p><span class="status-indicator status-pending"></span>ìŒì„± ìƒì„±: <span id="audioGenerationStatus">ëŒ€ê¸° ì¤‘</span></p>
                <p><span class="status-indicator status-pending"></span>ë¹„ë””ì˜¤ ë Œë”ë§: <span id="videoStatus">ëŒ€ê¸° ì¤‘</span></p>
            </div>
            
            <div id="finalResult" style="margin-top: 20px; display: none;">
                <h3>ğŸ‰ ìµœì¢… ê²°ê³¼</h3>
                <div id="finalInfo"></div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentScript = null;
        let currentAudio = null;
        let currentVideo = null;

        // ìƒ˜í”Œ ë°ì´í„°
        const sampleScripts = {
            product: {
                title: "í˜ì‹ ì ì¸ AI ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ ì¶œì‹œ!",
                content: "ë“œë””ì–´ ê³µê°œí•©ë‹ˆë‹¤! ë‹¹ì‹ ì˜ ì¼ìƒì„ ë°”ê¿€ AI ìŠ¤ë§ˆíŠ¸ì›Œì¹˜! ê±´ê°• ê´€ë¦¬ë¶€í„° ì¼ì • ê´€ë¦¬ê¹Œì§€, ëª¨ë“  ê²ƒì„ í•œ ë²ˆì—! ë†“ì¹˜ë©´ í›„íšŒí•˜ëŠ” íŠ¹ë³„ í• ì¸ ì´ë²¤íŠ¸! ì§€ê¸ˆ ë°”ë¡œ ë§Œë‚˜ë³´ì„¸ìš”!"
            },
            tutorial: {
                title: "5ë¶„ë§Œì— ë°°ìš°ëŠ” ì˜ìƒ í¸ì§‘",
                content: "ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ë”°ë¼í•  ìˆ˜ ìˆëŠ” ì˜ìƒ í¸ì§‘ì„ ë°°ì›Œë³¼ê¹Œìš”? ì •ë§ ê°„ë‹¨í•´ìš”! ì°¨ê·¼ì°¨ê·¼ ë”°ë¼í•´ë³´ì„¸ìš”. ì—¬ëŸ¬ë¶„ë„ ë©‹ì§„ ì˜ìƒì„ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”!"
            },
            event: {
                title: "2024 ì—°ë§ ëŒ€ì¶•ì œ",
                content: "ì˜¬í•´ë¥¼ ë§ˆë¬´ë¦¬í•˜ëŠ” íŠ¹ë³„í•œ ì¶•ì œì— ì—¬ëŸ¬ë¶„ì„ ì´ˆëŒ€í•©ë‹ˆë‹¤! ë†€ë¼ìš´ ê³µì—°ê³¼ í‘¸ì§í•œ ê²½í’ˆì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”! 12ì›” 31ì¼, ìš°ë¦¬ ëª¨ë‘ í•¨ê»˜ ì¶•í•˜í•´ìš”!"
            }
        };

        // ìƒ˜í”Œ ë¡œë“œ
        function loadSample(type) {
            const sample = sampleScripts[type];
            if (sample) {
                document.getElementById('scriptTitle').value = sample.title;
                document.getElementById('scriptContent').value = sample.content;
                
                // ìŠ¤íƒ€ì¼ ìë™ ì„ íƒ
                if (type === 'product') {
                    document.getElementById('videoStyle').value = 'promotional';
                } else if (type === 'tutorial') {
                    document.getElementById('videoStyle').value = 'educational';
                } else if (type === 'event') {
                    document.getElementById('videoStyle').value = 'entertainment';
                }
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(step, status, type = 'pending') {
            const statusMap = {
                'script': 'scriptStatus',
                'audio': 'audioGenerationStatus',
                'video': 'videoStatus'
            };
            
            const element = document.getElementById(statusMap[step]);
            if (element) {
                element.textContent = status;
                const indicator = element.parentElement.querySelector('.status-indicator');
                indicator.className = `status-indicator status-${type}`;
            }
        }

        // ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
        async function generateScript() {
            const title = document.getElementById('scriptTitle').value;
            const content = document.getElementById('scriptContent').value;
            const videoStyle = document.getElementById('videoStyle').value;
            const generateAudio = document.getElementById('generateAudio').checked;
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            updateStatus('script', 'ìƒì„± ì¤‘...', 'processing');
            document.getElementById('scriptResult').style.display = 'block';
            document.getElementById('scriptResult').innerHTML = '<div class="loading">ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
            
            try {
                const response = await fetch('/api/scripts/generate-video-script', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        baseScript: {
                            id: 'custom_' + Date.now(),
                            title: title,
                            description: 'ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸',
                            category: videoStyle,
                            tags: [videoStyle],
                            content: {
                                narration: content,
                                scenes: []
                            }
                        },
                        narrationSpeed: 'normal',
                        videoStyle: videoStyle,
                        generateAudio: generateAudio,
                        voiceStyle: 'energetic'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentScript = result.data;
                    
                    document.getElementById('scriptResult').innerHTML = `
                        <div class="success">âœ… ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ!</div>
                        <p><strong>ì œëª©:</strong> ${currentScript.title}</p>
                        <p><strong>ê¸¸ì´:</strong> ${currentScript.totalDuration}ì´ˆ</p>
                        <p><strong>ì¥ë©´ ìˆ˜:</strong> ${currentScript.scenes.length}ê°œ</p>
                        <details>
                            <summary>ìƒì„¸ ì •ë³´ ë³´ê¸°</summary>
                            <pre>${JSON.stringify(currentScript, null, 2)}</pre>
                        </details>
                    `;
                    
                    updateStatus('script', 'ì™„ë£Œ', 'completed');
                    
                    // ìŒì„±ì´ ìƒì„±ëœ ê²½ìš°
                    if (currentScript.audio) {
                        currentAudio = currentScript.audio;
                        showAudio();
                    }
                    
                    // ë¹„ë””ì˜¤ ìƒì„± ë²„íŠ¼ í™œì„±í™”
                    document.getElementById('generateVideoBtn').disabled = false;
                    
                } else {
                    throw new Error(result.error || 'ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì˜¤ë¥˜:', error);
                document.getElementById('scriptResult').innerHTML = `
                    <div class="error">âŒ ì˜¤ë¥˜: ${error.message}</div>
                `;
                updateStatus('script', 'ì‹¤íŒ¨', 'error');
            }
        }

        // ìŒì„± í‘œì‹œ
        function showAudio() {
            if (!currentAudio) return;
            
            updateStatus('audio', 'ì™„ë£Œ', 'completed');
            document.getElementById('audioSection').style.display = 'block';
            document.getElementById('audioStatus').style.display = 'none';
            
            document.getElementById('voiceInfo').textContent = 
                `${currentAudio.voiceUsed} (${currentAudio.duration}ì´ˆ)`;
            
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.src = currentAudio.audioUrl;
            
            // ë§Œì¡±ë„ ë³€ê²½ ì‹œ ì¬ìƒì„± ë²„íŠ¼ í‘œì‹œ
            document.getElementById('audioSatisfaction').onchange = function(e) {
                document.getElementById('regenerateBtn').style.display = 
                    e.target.value === 'regenerate' ? 'block' : 'none';
            };
        }

        // ìŒì„± ì¬ìƒì„±
        async function regenerateAudio() {
            if (!currentScript) return;
            
            updateStatus('audio', 'ì¬ìƒì„± ì¤‘...', 'processing');
            document.getElementById('audioStatus').style.display = 'block';
            document.getElementById('audioStatus').textContent = 'ìƒˆë¡œìš´ ìŒì„±ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            
            try {
                // ë‹¤ë¥¸ ê°ì •ìœ¼ë¡œ ì¬ìƒì„±
                const emotions = ['excited', 'motivated', 'enthusiastic', 'cheerful', 'celebratory'];
                const currentEmotion = 'excited'; // í˜„ì¬ ê°ì •
                const newEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                
                const response = await fetch('/api/tts/energetic', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: currentScript.narration.fullText,
                        emotion: newEmotion,
                        intensity: 'high',
                        gender: Math.random() > 0.5 ? 'male' : 'female'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentAudio = result.data;
                    showAudio();
                    document.getElementById('audioStatus').innerHTML = 
                        '<div class="success">âœ… ìƒˆë¡œìš´ ìŒì„±ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                } else {
                    throw new Error(result.error || 'ìŒì„± ì¬ìƒì„± ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('ìŒì„± ì¬ìƒì„± ì˜¤ë¥˜:', error);
                document.getElementById('audioStatus').innerHTML = 
                    `<div class="error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // ë¹„ë””ì˜¤ ìƒì„±
        async function generateVideo() {
            if (!currentScript) {
                alert('ë¨¼ì € ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            updateStatus('video', 'ìƒì„± ì¤‘...', 'processing');
            document.getElementById('videoProgress').style.display = 'block';
            
            // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ê²½ë¡œ
            const imageMap = {
                'nature': ['/test-images/nature1.jpg', '/test-images/nature2.jpg', '/test-images/nature3.jpg', '/test-images/nature4.jpg', '/test-images/nature5.jpg'],
                'tech': ['/test-images/tech1.jpg', '/test-images/tech2.jpg', '/test-images/tech3.jpg', '/test-images/tech4.jpg', '/test-images/tech5.jpg'],
                'food': ['/test-images/food1.jpg', '/test-images/food2.jpg', '/test-images/food3.jpg', '/test-images/food4.jpg', '/test-images/food5.jpg'],
                'abstract': ['/test-images/abstract1.jpg', '/test-images/abstract2.jpg', '/test-images/abstract3.jpg', '/test-images/abstract4.jpg', '/test-images/abstract5.jpg']
            };
            
            const selectedImages = document.getElementById('testImages').value;
            const quality = document.getElementById('videoQuality').value;
            const images = imageMap[selectedImages] || imageMap['nature'];
            
            // ì§„í–‰ë¥  ì‹œë®¬ë ˆì´ì…˜
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                document.getElementById('progressFill').style.width = progress + '%';
            }, 500);
            
            try {
                const response = await fetch('/api/videos/render', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        images: images,
                        audioUrl: currentAudio?.audioUrl,
                        videoScript: currentScript,
                        outputFormat: 'mp4',
                        quality: quality,
                        resolution: quality === 'high' ? '1080x1920' : quality === 'medium' ? '720x1280' : '540x960',
                        frameRate: 30,
                        projectTitle: currentScript.title
                    })
                });
                
                clearInterval(progressInterval);
                document.getElementById('progressFill').style.width = '100%';
                
                const result = await response.json();
                
                if (result.success) {
                    currentVideo = result.data;
                    
                    document.getElementById('videoResult').style.display = 'block';
                    document.getElementById('videoPlayer').src = currentVideo.videoUrl;
                    document.getElementById('videoInfo').innerHTML = `
                        <div class="success">âœ… ë¹„ë””ì˜¤ ìƒì„± ì™„ë£Œ!</div>
                        <p><strong>í•´ìƒë„:</strong> ${currentVideo.resolution}</p>
                        <p><strong>ê¸¸ì´:</strong> ${currentVideo.duration}ì´ˆ</p>
                        <p><strong>í¬ê¸°:</strong> ${Math.round(currentVideo.fileSize / 1024 / 1024)}MB</p>
                    `;
                    
                    updateStatus('video', 'ì™„ë£Œ', 'completed');
                    showFinalResult();
                    
                } else {
                    throw new Error(result.error || 'ë¹„ë””ì˜¤ ìƒì„± ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('ë¹„ë””ì˜¤ ìƒì„± ì˜¤ë¥˜:', error);
                document.getElementById('videoResult').innerHTML = `
                    <div class="error">âŒ ì˜¤ë¥˜: ${error.message}</div>
                `;
                updateStatus('video', 'ì‹¤íŒ¨', 'error');
            }
            
            clearInterval(progressInterval);
            document.getElementById('videoProgress').style.display = 'none';
        }

        // ìµœì¢… ê²°ê³¼ í‘œì‹œ
        function showFinalResult() {
            document.getElementById('finalResult').style.display = 'block';
            document.getElementById('finalInfo').innerHTML = `
                <div class="success">
                    <h4>ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤! AI Shorts ì˜ìƒì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</h4>
                    <p>ì œëª©: ${currentScript.title}</p>
                    <p>ìŒì„±: ${currentAudio.voiceUsed}</p>
                    <p>ë¹„ë””ì˜¤: ${currentVideo.resolution} @ ${currentVideo.frameRate}fps</p>
                    <p>ì´ ê¸¸ì´: ${currentVideo.duration}ì´ˆ</p>
                </div>
                <button onclick="downloadVideo()" style="margin-top: 15px;">ğŸ“¥ ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œ</button>
                <button onclick="resetAll()" style="margin-top: 15px; background: #ff9800;">ğŸ”„ ìƒˆë¡œ ë§Œë“¤ê¸°</button>
            `;
        }

        // ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œ
        function downloadVideo() {
            if (currentVideo && currentVideo.videoUrl) {
                const a = document.createElement('a');
                a.href = currentVideo.videoUrl;
                a.download = currentScript.title + '.mp4';
                a.click();
            }
        }

        // ì „ì²´ ì´ˆê¸°í™”
        function resetAll() {
            currentScript = null;
            currentAudio = null;
            currentVideo = null;
            
            document.getElementById('scriptResult').style.display = 'none';
            document.getElementById('audioSection').style.display = 'none';
            document.getElementById('videoResult').style.display = 'none';
            document.getElementById('finalResult').style.display = 'none';
            document.getElementById('generateVideoBtn').disabled = true;
            
            updateStatus('script', 'ëŒ€ê¸° ì¤‘', 'pending');
            updateStatus('audio', 'ëŒ€ê¸° ì¤‘', 'pending');
            updateStatus('video', 'ëŒ€ê¸° ì¤‘', 'pending');
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('scriptTitle').value = '';
            document.getElementById('scriptContent').value = '';
        }

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServer() {
            try {
                const response = await fetch('/api/scripts/generate-video-script', { method: 'GET' });
                console.log('âœ… ì„œë²„ ì—°ê²° í™•ì¸');
            } catch (error) {
                console.error('âš ï¸ ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', error);
                alert('ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹™ë‹ˆë‹¤. npm run devë¡œ ì„œë²„ë¥¼ ì‹œì‘í•˜ì„¸ìš”.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ í™•ì¸
        checkServer();
    </script>
</body>
</html>