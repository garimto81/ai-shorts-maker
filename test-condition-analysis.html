<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ì œí’ˆ ìƒíƒœ ë° ì‚¬ìš©ê° ë¶„ì„ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .condition-new {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.05));
            border-left: 5px solid #22c55e;
        }
        
        .condition-light-wear {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.05));
            border-left: 5px solid #3b82f6;
        }
        
        .condition-moderate-wear {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.05));
            border-left: 5px solid #f59e0b;
        }
        
        .condition-heavy-wear {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05));
            border-left: 5px solid #ef4444;
        }
        
        .condition-damaged {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(156, 39, 176, 0.05));
            border-left: 5px solid #9c27b0;
        }
        
        .wear-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .wear-new { background: #22c55e; }
        .wear-light { background: #3b82f6; }
        .wear-moderate { background: #f59e0b; }
        .wear-heavy { background: #ef4444; }
        .wear-damaged { background: #9c27b0; }
        
        .loading-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="max-w-6xl mx-auto px-6 py-8">
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold mb-3 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent">
                ğŸ” ì œí’ˆ ìƒíƒœ ë° ì‚¬ìš©ê° ë¶„ì„
            </h1>
            <p class="text-gray-300 text-lg">AIê°€ ì œí’ˆì˜ ì‚¬ìš© í”ì , ë§ˆëª¨ë„, ìƒíƒœë¥¼ ì „ë¬¸ê°€ ìˆ˜ì¤€ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤</p>
            <div class="mt-6 flex justify-center flex-wrap gap-3 text-sm">
                <div class="flex items-center px-3 py-2 bg-green-600/20 rounded-full">
                    <span class="wear-indicator wear-new"></span>ìƒˆì œí’ˆ (Aê¸‰)
                </div>
                <div class="flex items-center px-3 py-2 bg-blue-600/20 rounded-full">
                    <span class="wear-indicator wear-light"></span>ê²½ë¯¸í•œ ì‚¬ìš©ê° (Bê¸‰)
                </div>
                <div class="flex items-center px-3 py-2 bg-yellow-600/20 rounded-full">
                    <span class="wear-indicator wear-moderate"></span>ë³´í†µ ì‚¬ìš©ê° (Cê¸‰)
                </div>
                <div class="flex items-center px-3 py-2 bg-red-600/20 rounded-full">
                    <span class="wear-indicator wear-heavy"></span>ì‹¬í•œ ì‚¬ìš©ê° (Dê¸‰)
                </div>
                <div class="flex items-center px-3 py-2 bg-purple-600/20 rounded-full">
                    <span class="wear-indicator wear-damaged"></span>íŒŒì†/ìˆ˜ë¦¬í•„ìš” (Eê¸‰)
                </div>
            </div>
        </div>

        <!-- Test Categories -->
        <div class="grid lg:grid-cols-4 gap-6 mb-8">
            <div class="analysis-card p-6 rounded-xl hover:bg-white/5 transition-all duration-300 cursor-pointer" onclick="testNewProducts()">
                <div class="text-center">
                    <div class="text-3xl mb-3">âœ¨</div>
                    <h3 class="text-lg font-bold mb-2">ìƒˆì œí’ˆ</h3>
                    <p class="text-gray-400 text-sm">ë¯¸ì‚¬ìš© ìƒíƒœ</p>
                </div>
            </div>
            
            <div class="analysis-card p-6 rounded-xl hover:bg-white/5 transition-all duration-300 cursor-pointer" onclick="testUsedProducts()">
                <div class="text-center">
                    <div class="text-3xl mb-3">ğŸ‘Ÿ</div>
                    <h3 class="text-lg font-bold mb-2">ì¤‘ê³ ì œí’ˆ</h3>
                    <p class="text-gray-400 text-sm">ì‚¬ìš©ê° ìˆëŠ”</p>
                </div>
            </div>
            
            <div class="analysis-card p-6 rounded-xl hover:bg-white/5 transition-all duration-300 cursor-pointer" onclick="testWornProducts()">
                <div class="text-center">
                    <div class="text-3xl mb-3">ğŸ‘œ</div>
                    <h3 class="text-lg font-bold mb-2">ë§ì´ ì‚¬ìš©ëœ</h3>
                    <p class="text-gray-400 text-sm">ë§ˆëª¨ í”ì </p>
                </div>
            </div>
            
            <div class="analysis-card p-6 rounded-xl hover:bg-white/5 transition-all duration-300 cursor-pointer" onclick="uploadCustomImages()">
                <div class="text-center">
                    <div class="text-3xl mb-3">ğŸ“¸</div>
                    <h3 class="text-lg font-bold mb-2">ì§ì ‘ ì—…ë¡œë“œ</h3>
                    <p class="text-gray-400 text-sm">ë‚´ ì œí’ˆ ë¶„ì„</p>
                </div>
            </div>
        </div>

        <!-- Analysis Guide -->
        <div class="analysis-card p-6 rounded-xl mb-8">
            <h3 class="text-xl font-bold mb-4">ğŸ¯ ìƒíƒœ ë¶„ì„ í•­ëª©</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div>
                    <h4 class="font-semibold text-blue-400 mb-2">ğŸ‘Ÿ ì‹ ë°œ</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>â€¢ ë°‘ì°½ ë§ˆëª¨ë„</li>
                        <li>â€¢ ë’¤ê¿ˆì¹˜ ë‹³ìŒ</li>
                        <li>â€¢ ì–´í¼ ë³€í˜•</li>
                        <li>â€¢ ëˆ ìƒíƒœ</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-green-400 mb-2">ğŸ“± ì „ìì œí’ˆ</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>â€¢ ìŠ¤í¬ë˜ì¹˜</li>
                        <li>â€¢ ì°Œê·¸ëŸ¬ì§</li>
                        <li>â€¢ í™”ë©´ ìƒíƒœ</li>
                        <li>â€¢ ë²„íŠ¼ ë§ˆëª¨</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-yellow-400 mb-2">ğŸ‘œ ê°€ì£½ì œí’ˆ</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>â€¢ ì£¼ë¦„, ê°ˆë¼ì§</li>
                        <li>â€¢ ìƒ‰ ë³€í™”</li>
                        <li>â€¢ ëª¨ì„œë¦¬ ë§ˆëª¨</li>
                        <li>â€¢ ê¸ˆì†ë¶€í’ˆ ë³€ìƒ‰</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold text-purple-400 mb-2">ğŸ‘• ì˜ë¥˜</h4>
                    <ul class="text-sm text-gray-300 space-y-1">
                        <li>â€¢ ë³´í’€, ë³€ìƒ‰</li>
                        <li>â€¢ ëŠ˜ì–´ë‚¨</li>
                        <li>â€¢ ì–¼ë£©, êµ¬ë©</li>
                        <li>â€¢ ì§€í¼/ë‹¨ì¶” ìƒíƒœ</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <div class="analysis-card p-6 rounded-xl mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">ğŸ“Š ìƒíƒœ ë¶„ì„ ê²°ê³¼</h2>
                    <button id="exportResults" class="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 text-sm">
                        ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
                    </button>
                </div>
                <div id="resultsList" class="space-y-4">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Statistics -->
            <div id="statisticsSection" class="grid md:grid-cols-3 gap-6">
                <div class="analysis-card p-6 rounded-xl">
                    <h3 class="text-lg font-semibold mb-3">ğŸ“ˆ ìƒíƒœ ë¶„í¬</h3>
                    <div id="conditionChart" class="space-y-2">
                        <!-- Chart will be populated here -->
                    </div>
                </div>
                
                <div class="analysis-card p-6 rounded-xl">
                    <h3 class="text-lg font-semibold mb-3">ğŸ¯ ë¶„ì„ ì •í™•ë„</h3>
                    <div id="accuracyMetrics" class="space-y-3">
                        <!-- Metrics will be populated here -->
                    </div>
                </div>
                
                <div class="analysis-card p-6 rounded-xl">
                    <h3 class="text-lg font-semibold mb-3">ğŸ’° ì˜ˆìƒ ê°€ì¹˜</h3>
                    <div id="valueEstimation" class="space-y-3">
                        <!-- Value estimation will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden File Input -->
        <input type="file" id="fileInput" accept="image/*" multiple class="hidden">

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50">
            <div class="analysis-card p-8 rounded-xl text-center">
                <div class="loading-pulse text-4xl mb-4">ğŸ”</div>
                <h3 class="text-xl font-semibold mb-2">AI ìƒíƒœ ë¶„ì„ ì§„í–‰ ì¤‘</h3>
                <p class="text-gray-400" id="loadingText">ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘...</p>
                <div class="mt-4 w-64 bg-gray-700 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test datasets with different condition levels
        const conditionTestData = {
            new: [
                {
                    url: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800',
                    name: 'ìƒˆ ë‚˜ì´í‚¤ ìš´ë™í™”',
                    expectedCondition: 'new',
                    expectedKeywords: ['ìƒˆê²ƒ', 'ë¯¸ì‚¬ìš©', 'ê¹¨ë—í•œ']
                },
                {
                    url: 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=800',
                    name: 'ìƒˆ ì•„ì´í°',
                    expectedCondition: 'new',
                    expectedKeywords: ['ìƒˆê²ƒ', 'ë¯¸ì‚¬ìš©', 'ê¹¨ë—í•œ']
                }
            ],
            used: [
                {
                    url: 'https://images.unsplash.com/photo-1549298916-b41d501d3772?w=800',
                    name: 'ì¤‘ê³  ìš´ë™í™”',
                    expectedCondition: 'light-wear',
                    expectedKeywords: ['ê²½ë¯¸í•œ', 'ì‚¬ìš©ê°', 'ì•½ê°„']
                },
                {
                    url: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=800',
                    name: 'ì‚¬ìš©ëœ ë¨¸ê·¸ì»µ',
                    expectedCondition: 'light-wear',
                    expectedKeywords: ['ì‚¬ìš©', 'í”ì ', 'ê²½ë¯¸í•œ']
                }
            ],
            worn: [
                {
                    url: 'https://images.unsplash.com/photo-1544441893-675973e31985?w=800',
                    name: 'ë§ì´ ì‚¬ìš©ëœ ê°€ë°©',
                    expectedCondition: 'moderate-wear',
                    expectedKeywords: ['ë§ˆëª¨', 'ì‚¬ìš©ê°', 'í”ì ']
                }
            ]
        };

        let analysisResults = [];
        let currentProgress = 0;

        // UI Elements
        const elements = {
            fileInput: document.getElementById('fileInput'),
            resultsSection: document.getElementById('resultsSection'),
            resultsList: document.getElementById('resultsList'),
            statisticsSection: document.getElementById('statisticsSection'),
            conditionChart: document.getElementById('conditionChart'),
            accuracyMetrics: document.getElementById('accuracyMetrics'),
            valueEstimation: document.getElementById('valueEstimation'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            loadingText: document.getElementById('loadingText'),
            progressBar: document.getElementById('progressBar'),
            exportResults: document.getElementById('exportResults')
        };

        // Show/Hide Loading
        function showLoading(text = 'ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...', progress = 0) {
            elements.loadingOverlay.classList.remove('hidden');
            elements.loadingText.textContent = text;
            elements.progressBar.style.width = `${progress}%`;
        }

        function hideLoading() {
            elements.loadingOverlay.classList.add('hidden');
        }

        // Analyze Image Condition
        async function analyzeImageCondition(imageUrl, imageName, expectedCondition = '', expectedKeywords = []) {
            try {
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                
                const formData = new FormData();
                formData.append('image', blob, `${imageName}.jpg`);
                
                const apiResponse = await fetch('/api/analyze-image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await apiResponse.json();
                
                if (result.success) {
                    const analysis = result.analysis;
                    const conditionLevel = determineConditionLevel(analysis);
                    const qualityScore = calculateConditionAccuracy(analysis, expectedKeywords);
                    const estimatedValue = estimateValue(conditionLevel, analysis);
                    
                    return {
                        imageName,
                        imageUrl,
                        analysis,
                        conditionLevel,
                        expectedCondition,
                        expectedKeywords,
                        qualityScore,
                        estimatedValue,
                        timestamp: new Date().toLocaleTimeString(),
                        success: true
                    };
                } else {
                    throw new Error(result.error || 'ë¶„ì„ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                return {
                    imageName,
                    imageUrl,
                    analysis: `ì˜¤ë¥˜: ${error.message}`,
                    conditionLevel: 'unknown',
                    expectedCondition,
                    expectedKeywords,
                    qualityScore: 0,
                    estimatedValue: 0,
                    timestamp: new Date().toLocaleTimeString(),
                    success: false
                };
            }
        }

        // Determine Condition Level from Analysis
        function determineConditionLevel(analysis) {
            const text = analysis.toLowerCase();
            
            if (text.includes('ìƒˆê²ƒ') || text.includes('ë¯¸ì‚¬ìš©') || text.includes('ê¹¨ë—í•œ')) {
                return 'new';
            } else if (text.includes('ê²½ë¯¸í•œ') || text.includes('ì•½ê°„')) {
                return 'light-wear';
            } else if (text.includes('ì‚¬ìš© í”ì ') || text.includes('ì¼ë¶€ ë§ˆëª¨') || text.includes('ë³´í†µ')) {
                return 'moderate-wear';
            } else if (text.includes('ë§ì´ ì‚¬ìš©ëœ') || text.includes('ë§ˆëª¨ ì‹¬í•œ') || text.includes('ë‚¡ì€')) {
                return 'heavy-wear';
            } else if (text.includes('ì†ìƒëœ') || text.includes('ì°¢ì–´ì§„') || text.includes('ê¹¨ì§„')) {
                return 'damaged';
            } else {
                return 'unknown';
            }
        }

        // Calculate Condition Analysis Accuracy
        function calculateConditionAccuracy(analysis, expectedKeywords) {
            if (expectedKeywords.length === 0) return 50; // Default for no expected keywords
            
            const analysisLower = analysis.toLowerCase();
            let matchCount = 0;
            
            expectedKeywords.forEach(keyword => {
                if (analysisLower.includes(keyword.toLowerCase())) {
                    matchCount++;
                }
            });
            
            // Base accuracy from keyword matching
            let accuracy = (matchCount / expectedKeywords.length) * 60;
            
            // Bonus for detailed condition analysis
            const detailIndicators = [
                'ìŠ¤í¬ë˜ì¹˜', 'ë§ˆëª¨', 'í”ì ', 'ë³€ìƒ‰', 'ê°ˆë¼ì§', 'ì°Œê·¸ëŸ¬ì§',
                'ë°‘ì°½', 'ë’¤ê¿ˆì¹˜', 'ëª¨ì„œë¦¬', 'ì£¼ë¦„', 'ë³´í’€', 'ì–¼ë£©'
            ];
            
            const detailCount = detailIndicators.filter(indicator => 
                analysisLower.includes(indicator)).length;
            
            accuracy += Math.min(detailCount * 8, 40); // Max 40 bonus points
            
            return Math.min(Math.round(accuracy), 100);
        }

        // Estimate Value based on Condition
        function estimateValue(conditionLevel, analysis) {
            const baseValues = {
                'new': 100,
                'light-wear': 80,
                'moderate-wear': 60,
                'heavy-wear': 40,
                'damaged': 20,
                'unknown': 50
            };
            
            let value = baseValues[conditionLevel] || 50;
            
            // Brand premium
            const premiumBrands = ['ì•„ì´í°', 'ë§¥ë¶', 'ë‚˜ì´í‚¤', 'ì•„ë””ë‹¤ìŠ¤', 'ë£¨ì´ë¹„í†µ', 'êµ¬ì°Œ'];
            if (premiumBrands.some(brand => analysis.includes(brand))) {
                value += 10;
            }
            
            return Math.min(value, 100);
        }

        // Display Results
        function displayResults(results) {
            elements.resultsSection.classList.remove('hidden');
            elements.resultsList.innerHTML = '';
            
            results.forEach(result => {
                const div = document.createElement('div');
                const conditionClass = `condition-${result.conditionLevel}`;
                
                const conditionLabels = {
                    'new': 'ìƒˆì œí’ˆ (Aê¸‰)',
                    'light-wear': 'ê²½ë¯¸í•œ ì‚¬ìš©ê° (Bê¸‰)',
                    'moderate-wear': 'ë³´í†µ ì‚¬ìš©ê° (Cê¸‰)',
                    'heavy-wear': 'ì‹¬í•œ ì‚¬ìš©ê° (Dê¸‰)',
                    'damaged': 'íŒŒì†/ìˆ˜ë¦¬í•„ìš” (Eê¸‰)',
                    'unknown': 'ë¶„ì„ ë¶ˆê°€'
                };
                
                const conditionIcons = {
                    'new': 'âœ¨',
                    'light-wear': 'ğŸ‘',
                    'moderate-wear': 'âš ï¸',
                    'heavy-wear': 'ğŸ‘',
                    'damaged': 'ğŸ’¥',
                    'unknown': 'â“'
                };
                
                div.className = `${conditionClass} p-6 rounded-xl`;
                
                div.innerHTML = `
                    <div class="flex items-start gap-4">
                        <img src="${result.imageUrl}" alt="${result.imageName}" 
                             class="w-28 h-28 object-cover rounded-xl border-2 border-white/10">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-xl font-bold">${result.imageName}</h3>
                                <div class="text-right">
                                    <div class="text-2xl mb-1">${conditionIcons[result.conditionLevel]}</div>
                                    <div class="text-sm font-semibold">${conditionLabels[result.conditionLevel]}</div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <p class="text-lg font-medium text-yellow-300 mb-2">"${result.analysis}"</p>
                                <div class="flex items-center gap-4 text-sm">
                                    <span class="px-3 py-1 bg-blue-600/30 rounded-full">
                                        ì •í™•ë„: ${result.qualityScore}ì 
                                    </span>
                                    <span class="px-3 py-1 bg-green-600/30 rounded-full">
                                        ì˜ˆìƒ ê°€ì¹˜: ${result.estimatedValue}%
                                    </span>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">ìƒíƒœ ë“±ê¸‰:</span>
                                    <div class="font-semibold">${conditionLabels[result.conditionLevel]}</div>
                                </div>
                                <div>
                                    <span class="text-gray-400">ë¶„ì„ ì‹œê°„:</span>
                                    <div class="font-semibold">${result.timestamp}</div>
                                </div>
                                <div>
                                    <span class="text-gray-400">ê¸°ëŒ€ í‚¤ì›Œë“œ:</span>
                                    <div class="font-semibold">${result.expectedKeywords.join(', ') || 'ì—†ìŒ'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                elements.resultsList.appendChild(div);
            });
            
            updateStatistics(results);
        }

        // Update Statistics
        function updateStatistics(results) {
            updateConditionChart(results);
            updateAccuracyMetrics(results);
            updateValueEstimation(results);
        }

        function updateConditionChart(results) {
            const conditions = {};
            results.forEach(result => {
                conditions[result.conditionLevel] = (conditions[result.conditionLevel] || 0) + 1;
            });
            
            const labels = {
                'new': 'ìƒˆì œí’ˆ',
                'light-wear': 'ê²½ë¯¸í•œ ì‚¬ìš©ê°',
                'moderate-wear': 'ë³´í†µ ì‚¬ìš©ê°',
                'heavy-wear': 'ì‹¬í•œ ì‚¬ìš©ê°',
                'damaged': 'íŒŒì†',
                'unknown': 'ë¶„ì„ ë¶ˆê°€'
            };
            
            const colors = {
                'new': 'bg-green-500',
                'light-wear': 'bg-blue-500',
                'moderate-wear': 'bg-yellow-500',
                'heavy-wear': 'bg-red-500',
                'damaged': 'bg-purple-500',
                'unknown': 'bg-gray-500'
            };
            
            elements.conditionChart.innerHTML = Object.entries(conditions)
                .map(([condition, count]) => `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full ${colors[condition]}"></div>
                            <span class="text-sm">${labels[condition]}</span>
                        </div>
                        <span class="font-semibold">${count}ê°œ</span>
                    </div>
                `).join('');
        }

        function updateAccuracyMetrics(results) {
            const avgAccuracy = results.reduce((sum, r) => sum + r.qualityScore, 0) / results.length;
            const successRate = results.filter(r => r.success).length / results.length * 100;
            const detailedAnalysis = results.filter(r => r.analysis.length > 20).length;
            
            elements.accuracyMetrics.innerHTML = `
                <div class="flex justify-between">
                    <span>í‰ê·  ì •í™•ë„:</span>
                    <span class="font-bold">${Math.round(avgAccuracy)}ì </span>
                </div>
                <div class="flex justify-between">
                    <span>ì„±ê³µë¥ :</span>
                    <span class="font-bold">${Math.round(successRate)}%</span>
                </div>
                <div class="flex justify-between">
                    <span>ìƒì„¸ ë¶„ì„:</span>
                    <span class="font-bold">${detailedAnalysis}/${results.length}</span>
                </div>
            `;
        }

        function updateValueEstimation(results) {
            const avgValue = results.reduce((sum, r) => sum + r.estimatedValue, 0) / results.length;
            const highValue = results.filter(r => r.estimatedValue >= 80).length;
            const lowValue = results.filter(r => r.estimatedValue < 40).length;
            
            elements.valueEstimation.innerHTML = `
                <div class="flex justify-between">
                    <span>í‰ê·  ê°€ì¹˜:</span>
                    <span class="font-bold">${Math.round(avgValue)}%</span>
                </div>
                <div class="flex justify-between">
                    <span>ê³ ê°€ì¹˜ (80%+):</span>
                    <span class="font-bold">${highValue}ê°œ</span>
                </div>
                <div class="flex justify-between">
                    <span>ì €ê°€ì¹˜ (<40%):</span>
                    <span class="font-bold">${lowValue}ê°œ</span>
                </div>
            `;
        }

        // Test Functions
        async function testNewProducts() {
            await runConditionTest(conditionTestData.new, 'ìƒˆì œí’ˆ');
        }

        async function testUsedProducts() {
            await runConditionTest(conditionTestData.used, 'ì¤‘ê³ ì œí’ˆ');
        }

        async function testWornProducts() {
            await runConditionTest(conditionTestData.worn, 'ë§ì´ ì‚¬ìš©ëœ ì œí’ˆ');
        }

        async function runConditionTest(testData, categoryName) {
            console.log(`${categoryName} ìƒíƒœ ë¶„ì„ í…ŒìŠ¤íŠ¸ ì‹œì‘...`);
            
            const results = [];
            const totalItems = testData.length;
            
            for (let i = 0; i < totalItems; i++) {
                const item = testData[i];
                const progress = ((i + 1) / totalItems) * 100;
                
                showLoading(`${categoryName} ë¶„ì„ ì¤‘... (${i + 1}/${totalItems})`, progress);
                
                const result = await analyzeImageCondition(
                    item.url, 
                    item.name, 
                    item.expectedCondition, 
                    item.expectedKeywords
                );
                
                results.push(result);
                displayResults(results);
                
                if (i < totalItems - 1) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            hideLoading();
            analysisResults = results;
        }

        function uploadCustomImages() {
            elements.fileInput.click();
        }

        // Event Listeners
        elements.fileInput.addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            const results = [];
            const totalFiles = files.length;
            
            for (let i = 0; i < totalFiles; i++) {
                const file = files[i];
                const progress = ((i + 1) / totalFiles) * 100;
                
                showLoading(`"${file.name}" ë¶„ì„ ì¤‘... (${i + 1}/${totalFiles})`, progress);
                
                try {
                    const formData = new FormData();
                    formData.append('image', file);
                    
                    const response = await fetch('/api/analyze-image', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        const conditionLevel = determineConditionLevel(result.analysis);
                        const qualityScore = calculateConditionAccuracy(result.analysis, []);
                        const estimatedValue = estimateValue(conditionLevel, result.analysis);
                        
                        results.push({
                            imageName: file.name,
                            imageUrl: URL.createObjectURL(file),
                            analysis: result.analysis,
                            conditionLevel,
                            expectedCondition: '',
                            expectedKeywords: [],
                            qualityScore,
                            estimatedValue,
                            timestamp: new Date().toLocaleTimeString(),
                            success: true
                        });
                    }
                } catch (error) {
                    console.error('ë¶„ì„ ì‹¤íŒ¨:', error);
                }
                
                displayResults(results);
                
                if (i < totalFiles - 1) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            hideLoading();
            analysisResults = results;
        });

        elements.exportResults.addEventListener('click', () => {
            if (analysisResults.length === 0) {
                alert('ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const csvContent = "ì´ë¯¸ì§€ëª…,ë¶„ì„ê²°ê³¼,ìƒíƒœë“±ê¸‰,ì •í™•ë„,ì˜ˆìƒê°€ì¹˜,ë¶„ì„ì‹œê°„\n" + 
                analysisResults.map(r => 
                    `"${r.imageName}","${r.analysis}","${r.conditionLevel}",${r.qualityScore},${r.estimatedValue},"${r.timestamp}"`
                ).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `condition_analysis_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        });

        // Global functions
        window.testNewProducts = testNewProducts;
        window.testUsedProducts = testUsedProducts;
        window.testWornProducts = testWornProducts;
        window.uploadCustomImages = uploadCustomImages;

        console.log('ğŸ” ì œí’ˆ ìƒíƒœ ë° ì‚¬ìš©ê° ë¶„ì„ í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ');
    </script>
</body>
</html>