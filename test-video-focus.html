<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ìƒ ìƒì„± í…ŒìŠ¤íŠ¸ - FFmpeg ì§‘ì¤‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading { display: none; }
        .loading.show { display: block; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-3xl">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h1 class="text-2xl font-bold text-center mb-6 text-green-600">
                ğŸ¬ ì˜ìƒ ìƒì„± í…ŒìŠ¤íŠ¸ (FFmpeg ì§‘ì¤‘)
            </h1>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- ê¸°ë³¸ ì˜ìƒ ìƒì„± -->
                <div class="border rounded-lg p-4">
                    <h2 class="text-lg font-semibold mb-4 text-blue-600">ğŸ“¹ ê¸°ë³¸ ì˜ìƒ (ì—°ê²°ë§Œ)</h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì´ë¯¸ì§€ ì„ íƒ (ìµœì†Œ 2ì¥):
                        </label>
                        <input 
                            type="file" 
                            id="basicImages" 
                            accept="image/*" 
                            multiple 
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                        >
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ê° ì´ë¯¸ì§€ ì§€ì†ì‹œê°„ (ì´ˆ):
                        </label>
                        <input 
                            type="number" 
                            id="basicDuration" 
                            value="3" 
                            min="1" 
                            max="10" 
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md"
                        >
                    </div>

                    <button 
                        onclick="testBasicVideo()" 
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200"
                    >
                        ğŸ¬ ê¸°ë³¸ ì˜ìƒ ìƒì„±
                    </button>

                    <div id="basicResult" class="mt-4 hidden">
                        <pre id="basicResultText" class="text-sm bg-gray-100 p-3 rounded border overflow-x-auto"></pre>
                        <div id="basicDownload" class="hidden mt-2">
                            <a id="basicDownloadLink" href="#" download class="inline-block bg-green-600 text-white py-1 px-3 rounded text-sm hover:bg-green-700">
                                ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ì „í™˜ íš¨ê³¼ í…ŒìŠ¤íŠ¸ -->
                <div class="border rounded-lg p-4">
                    <h2 class="text-lg font-semibold mb-4 text-purple-600">âœ¨ ì „í™˜ íš¨ê³¼ í…ŒìŠ¤íŠ¸</h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì´ë¯¸ì§€ ì„ íƒ (ìµœì†Œ 2ì¥):
                        </label>
                        <input 
                            type="file" 
                            id="transitionImages" 
                            accept="image/*" 
                            multiple 
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100"
                        >
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ì „í™˜ íš¨ê³¼:
                        </label>
                        <select 
                            id="transitionType" 
                            class="block w-full px-3 py-2 border border-gray-300 rounded-md"
                        >
                            <option value="crossfade">í¬ë¡œìŠ¤í˜ì´ë“œ</option>
                            <option value="slideleft">ì™¼ìª½ ìŠ¬ë¼ì´ë“œ</option>
                            <option value="slideright">ì˜¤ë¥¸ìª½ ìŠ¬ë¼ì´ë“œ</option>
                            <option value="slideup">ìœ„ìª½ ìŠ¬ë¼ì´ë“œ</option>
                            <option value="slidedown">ì•„ë˜ìª½ ìŠ¬ë¼ì´ë“œ</option>
                            <option value="dissolve">ë””ì¡¸ë¸Œ</option>
                            <option value="circleopen">ì›í˜• í™•ì¥</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">ì´ë¯¸ì§€ ì§€ì†ì‹œê°„:</label>
                            <input 
                                type="number" 
                                id="transitionDuration" 
                                value="2" 
                                min="1" 
                                max="5" 
                                class="block w-full px-2 py-1 border border-gray-300 rounded text-sm"
                            >
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">ì „í™˜ ì‹œê°„:</label>
                            <input 
                                type="number" 
                                id="transitionTime" 
                                value="1" 
                                min="0.5" 
                                max="3" 
                                step="0.5" 
                                class="block w-full px-2 py-1 border border-gray-300 rounded text-sm"
                            >
                        </div>
                    </div>

                    <button 
                        onclick="testTransitionVideo()" 
                        class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition duration-200"
                    >
                        âœ¨ ì „í™˜ íš¨ê³¼ í…ŒìŠ¤íŠ¸
                    </button>

                    <div id="transitionResult" class="mt-4 hidden">
                        <pre id="transitionResultText" class="text-sm bg-gray-100 p-3 rounded border overflow-x-auto"></pre>
                        <div id="transitionDownload" class="hidden mt-2">
                            <a id="transitionDownloadLink" href="#" download class="inline-block bg-green-600 text-white py-1 px-3 rounded text-sm hover:bg-green-700">
                                ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="loading" class="loading text-center py-4 mt-6">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"></div>
                <p class="text-gray-600 mt-2">ì˜ìƒ ìƒì„± ì¤‘...</p>
                <div id="progressText" class="text-sm text-gray-500 mt-1"></div>
            </div>

            <!-- FFmpeg ëª…ë ¹ì–´ í‘œì‹œ -->
            <div id="ffmpegCommand" class="mt-6 hidden">
                <h3 class="font-semibold text-gray-800 mb-2">ğŸ› ï¸ FFmpeg ëª…ë ¹ì–´:</h3>
                <pre class="text-xs bg-black text-green-400 p-3 rounded overflow-x-auto" id="commandText"></pre>
            </div>
        </div>
    </div>

    <script>
        let currentTest = null;

        async function testBasicVideo() {
            const fileInput = document.getElementById('basicImages');
            const duration = document.getElementById('basicDuration').value;
            
            if (!fileInput.files || fileInput.files.length < 2) {
                alert('ìµœì†Œ 2ì¥ì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            await runTest('/api/test-simple-video', {
                files: fileInput.files,
                duration: duration
            }, 'basic');
        }

        async function testTransitionVideo() {
            const fileInput = document.getElementById('transitionImages');
            const transitionType = document.getElementById('transitionType').value;
            const duration = document.getElementById('transitionDuration').value;
            const transitionTime = document.getElementById('transitionTime').value;
            
            if (!fileInput.files || fileInput.files.length < 2) {
                alert('ìµœì†Œ 2ì¥ì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            await runTest('/api/test-transitions', {
                files: fileInput.files,
                transitionType: transitionType,
                duration: duration,
                transitionDuration: transitionTime
            }, 'transition');
        }

        async function runTest(endpoint, params, testType) {
            const loading = document.getElementById('loading');
            const resultDiv = document.getElementById(`${testType}Result`);
            const resultText = document.getElementById(`${testType}ResultText`);
            const downloadSection = document.getElementById(`${testType}Download`);
            const downloadLink = document.getElementById(`${testType}DownloadLink`);
            const ffmpegCommand = document.getElementById('ffmpegCommand');
            const commandText = document.getElementById('commandText');

            currentTest = testType;
            loading.classList.add('show');
            resultDiv.classList.add('hidden');
            ffmpegCommand.classList.add('hidden');

            const formData = new FormData();
            
            for (let i = 0; i < params.files.length; i++) {
                formData.append('images', params.files[i]);
            }
            
            Object.keys(params).forEach(key => {
                if (key !== 'files') {
                    formData.append(key, params[key]);
                }
            });

            try {
                console.log(`ğŸ¬ ${testType} í…ŒìŠ¤íŠ¸ ì‹œì‘`);
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                loading.classList.remove('show');
                resultDiv.classList.remove('hidden');

                if (data.success) {
                    resultText.textContent = JSON.stringify({
                        status: 'âœ… ì„±ê³µ',
                        filename: data.filename,
                        duration: data.duration + 'ì´ˆ',
                        processingTime: data.processingTime ? Math.round(data.processingTime/1000) + 'ì´ˆ' : 'ë¯¸ì¸¡ì •',
                        transitionType: data.transitionType || 'ì—†ìŒ'
                    }, null, 2);

                    if (data.downloadUrl || data.filename) {
                        const url = data.downloadUrl || `/output/${data.filename}`;
                        downloadLink.href = url;
                        downloadSection.classList.remove('hidden');
                    }
                } else {
                    resultText.textContent = JSON.stringify({
                        status: 'âŒ ì‹¤íŒ¨',
                        error: data.error,
                        details: data.details
                    }, null, 2);
                }

            } catch (error) {
                loading.classList.remove('show');
                resultDiv.classList.remove('hidden');
                
                resultText.textContent = JSON.stringify({
                    status: 'âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜',
                    error: error.message
                }, null, 2);

                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
            }
        }

        // íŒŒì¼ ì„ íƒ ì‹œ ì •ë³´ í‘œì‹œ
        document.getElementById('basicImages').addEventListener('change', function(e) {
            console.log(`ê¸°ë³¸ í…ŒìŠ¤íŠ¸: ${e.target.files.length}ê°œ ì´ë¯¸ì§€ ì„ íƒ`);
        });

        document.getElementById('transitionImages').addEventListener('change', function(e) {
            console.log(`ì „í™˜ íš¨ê³¼ í…ŒìŠ¤íŠ¸: ${e.target.files.length}ê°œ ì´ë¯¸ì§€ ì„ íƒ`);
        });
    </script>
</body>
</html>