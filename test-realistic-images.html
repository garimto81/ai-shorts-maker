<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ ì‹¤ì œ ì œí’ˆ ì´ë¯¸ì§€ ë¶„ì„ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-good {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid #22c55e;
        }
        
        .result-bad {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen text-white p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold mb-2">ğŸ¯ ì‹¤ì œ ì œí’ˆ ì´ë¯¸ì§€ AI ë¶„ì„ í…ŒìŠ¤íŠ¸</h1>
            <p class="text-gray-400">ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ë¡œ ë” ì •í™•í•œ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <!-- Test Categories -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <button id="testGoodImages" class="analysis-card p-6 rounded-lg hover:bg-white/10 transition-colors">
                <div class="text-center">
                    <div class="text-3xl mb-3">âœ…</div>
                    <h3 class="text-lg font-semibold mb-2">ì¢‹ì€ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€</h3>
                    <p class="text-sm text-gray-400">ëª…í™•í•œ ì œí’ˆ ì´ë¯¸ì§€ë“¤</p>
                </div>
            </button>
            
            <button id="testBadImages" class="analysis-card p-6 rounded-lg hover:bg-white/10 transition-colors">
                <div class="text-center">
                    <div class="text-3xl mb-3">âŒ</div>
                    <h3 class="text-lg font-semibold mb-2">ë¬¸ì œê°€ ìˆëŠ” ì´ë¯¸ì§€</h3>
                    <p class="text-sm text-gray-400">ë³µì¡í•˜ê±°ë‚˜ íë¦° ì´ë¯¸ì§€ë“¤</p>
                </div>
            </button>
            
            <button id="uploadCustom" class="analysis-card p-6 rounded-lg hover:bg-white/10 transition-colors">
                <div class="text-center">
                    <div class="text-3xl mb-3">ğŸ“¸</div>
                    <h3 class="text-lg font-semibold mb-2">ì§ì ‘ ì—…ë¡œë“œ</h3>
                    <p class="text-sm text-gray-400">ë‚´ ì´ë¯¸ì§€ë¡œ í…ŒìŠ¤íŠ¸</p>
                </div>
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden analysis-card p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ë¶„ì„ ê²°ê³¼ ë¹„êµ</h2>
            <div id="resultsList" class="space-y-4">
                <!-- Results will be added here -->
            </div>
            
            <div class="mt-6 p-4 bg-blue-900/20 rounded-lg">
                <h3 class="font-semibold mb-2">ğŸ’¡ ê°œì„ ëœ ì </h3>
                <ul class="text-sm text-gray-300 space-y-1">
                    <li>â€¢ êµ¬ì²´ì ì¸ ê°ì²´ ì„¤ëª… (ìƒ‰ìƒ + ì¬ì§ˆ + í˜•íƒœ)</li>
                    <li>â€¢ ì£¼ê´€ì  í˜•ìš©ì‚¬ ì œê±° ("ë©‹ì§„", "ì¢‹ì€" ë“±)</li>
                    <li>â€¢ ì—ëŸ¬ë³„ êµ¬ì²´ì ì¸ ë©”ì‹œì§€</li>
                    <li>â€¢ ë” ì •í™•í•œ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</li>
                </ul>
            </div>
        </div>

        <!-- Upload Input (Hidden) -->
        <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
    </div>

    <script>
        // í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ URLë“¤
        const testImages = {
            good: [
                {
                    url: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800',
                    name: 'ë‚˜ì´í‚¤ ìš´ë™í™”',
                    expected: 'í°ìƒ‰ ë‚˜ì´í‚¤ ìš´ë™í™”'
                },
                {
                    url: 'https://images.unsplash.com/photo-1484704849700-f032a568e944?w=800',
                    name: 'ì•„ì´í°',
                    expected: 'ê²€ì€ ì•„ì´í°'
                },
                {
                    url: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=800',
                    name: 'ì»¤í”¼ì»µ',
                    expected: 'í°ìƒ‰ ì»¤í”¼ì»µ'
                }
            ],
            bad: [
                {
                    url: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800',
                    name: 'ë³µì¡í•œ ìƒì ',
                    expected: 'ë‹¤ì–‘í•œ ìƒí’ˆë“¤'
                },
                {
                    url: 'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=800',
                    name: 'íë¦° ë°°ê²½',
                    expected: 'íŒ¨ì…˜ ì•„ì´í…œë“¤'
                }
            ]
        };

        let analysisResults = [];

        // ì´ë¯¸ì§€ ë¶„ì„ í•¨ìˆ˜
        async function analyzeImage(imageUrl, imageName, expectedResult) {
            console.log(`ğŸ” ë¶„ì„ ì‹œì‘: ${imageName}`);
            
            try {
                // ì´ë¯¸ì§€ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                
                const formData = new FormData();
                formData.append('image', blob, `${imageName}.jpg`);
                
                const apiResponse = await fetch('/api/analyze-image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await apiResponse.json();
                
                if (result.success) {
                    const analysis = result.analysis;
                    const isGood = !analysis.includes('ë©‹ì§„') && 
                                  !analysis.includes('ì¢‹ì€') && 
                                  !analysis.includes('í›Œë¥­í•œ') &&
                                  analysis.length > 5;
                    
                    console.log(`âœ… ë¶„ì„ ì™„ë£Œ: ${imageName} -> "${analysis}"`);
                    
                    return {
                        imageName,
                        imageUrl,
                        analysis,
                        expected: expectedResult,
                        isGood,
                        timestamp: new Date().toLocaleTimeString()
                    };
                } else {
                    throw new Error(result.error || 'ë¶„ì„ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error(`âŒ ë¶„ì„ ì‹¤íŒ¨: ${imageName}`, error);
                return {
                    imageName,
                    imageUrl,
                    analysis: `ì˜¤ë¥˜: ${error.message}`,
                    expected: expectedResult,
                    isGood: false,
                    timestamp: new Date().toLocaleTimeString()
                };
            }
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(results) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsList = document.getElementById('resultsList');
            
            resultsSection.classList.remove('hidden');
            resultsList.innerHTML = '';
            
            results.forEach(result => {
                const div = document.createElement('div');
                div.className = `p-4 rounded-lg ${result.isGood ? 'result-good' : 'result-bad'}`;
                
                const statusIcon = result.isGood ? 'âœ…' : 'âŒ';
                const statusText = result.isGood ? 'ì¢‹ì€ ê²°ê³¼' : 'ê°œì„  í•„ìš”';
                
                div.innerHTML = `
                    <div class="flex items-start gap-4">
                        <img src="${result.imageUrl}" alt="${result.imageName}" 
                             class="w-20 h-20 object-cover rounded-lg">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h3 class="font-semibold">${result.imageName}</h3>
                                <span class="text-sm px-2 py-1 rounded-full ${result.isGood ? 'bg-green-600' : 'bg-red-600'}">
                                    ${statusIcon} ${statusText}
                                </span>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div>
                                    <span class="text-gray-400">AI ë¶„ì„:</span> 
                                    <span class="${result.isGood ? 'text-green-400' : 'text-red-400'}">"${result.analysis}"</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">ê¸°ëŒ€ ê²°ê³¼:</span> 
                                    <span class="text-blue-400">"${result.expected}"</span>
                                </div>
                                <div class="text-xs text-gray-500">
                                    ë¶„ì„ ì‹œê°„: ${result.timestamp}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                resultsList.appendChild(div);
            });
            
            // í†µê³„ í‘œì‹œ
            const goodCount = results.filter(r => r.isGood).length;
            const totalCount = results.length;
            
            const statsDiv = document.createElement('div');
            statsDiv.className = 'mt-4 p-4 bg-gray-800 rounded-lg text-center';
            statsDiv.innerHTML = `
                <h3 class="font-semibold mb-2">ğŸ“ˆ ë¶„ì„ í’ˆì§ˆ í†µê³„</h3>
                <div class="text-2xl mb-1">${goodCount}/${totalCount}</div>
                <div class="text-sm text-gray-400">
                    ${Math.round((goodCount/totalCount)*100)}% í’ˆì§ˆ ê°œì„  ì„±ê³µ
                </div>
            `;
            
            resultsList.appendChild(statsDiv);
        }

        // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runTest(category) {
            const images = testImages[category];
            const results = [];
            
            console.log(`ğŸš€ ${category} ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ì‹œì‘...`);
            
            for (let i = 0; i < images.length; i++) {
                const image = images[i];
                console.log(`ğŸ“¸ ì²˜ë¦¬ ì¤‘: ${i+1}/${images.length} - ${image.name}`);
                
                const result = await analyzeImage(image.url, image.name, image.expected);
                results.push(result);
                
                // ì¤‘ê°„ ê²°ê³¼ í‘œì‹œ
                displayResults(results);
                
                // API í˜¸ì¶œ ê°„ê²© ì¡°ì ˆ
                if (i < images.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            console.log('âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
            analysisResults = results;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('testGoodImages').addEventListener('click', () => {
            runTest('good');
        });

        document.getElementById('testBadImages').addEventListener('click', () => {
            runTest('bad');
        });

        document.getElementById('uploadCustom').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            console.log(`ğŸ“ ${files.length}ê°œ íŒŒì¼ ì—…ë¡œë“œë¨`);
            
            const results = [];
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const dataUrl = await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
                
                const formData = new FormData();
                formData.append('image', file);
                
                try {
                    const response = await fetch('/api/analyze-image', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        const analysis = result.analysis;
                        const isGood = !analysis.includes('ë©‹ì§„') && 
                                      !analysis.includes('ì¢‹ì€') && 
                                      !analysis.includes('í›Œë¥­í•œ') &&
                                      analysis.length > 5;
                        
                        results.push({
                            imageName: file.name,
                            imageUrl: dataUrl,
                            analysis,
                            expected: 'ì‚¬ìš©ì ì—…ë¡œë“œ',
                            isGood,
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }
                } catch (error) {
                    results.push({
                        imageName: file.name,
                        imageUrl: dataUrl,
                        analysis: `ì˜¤ë¥˜: ${error.message}`,
                        expected: 'ì‚¬ìš©ì ì—…ë¡œë“œ',
                        isGood: false,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
                
                displayResults(results);
                await new Promise(resolve => setTimeout(resolve, 1500));
            }
        });

        // ì´ˆê¸°í™”
        console.log('ğŸ¯ ì‹¤ì œ ì œí’ˆ ì´ë¯¸ì§€ ë¶„ì„ í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¤€ë¹„ë¨');
    </script>
</body>
</html>