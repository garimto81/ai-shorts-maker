<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1f2937">
    <title>íœ ë³µì› AI ì‡¼ì¸  ì œì‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            min-height: 100vh;
        }
        .image-thumb {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 2px solid #4B5563;
            cursor: pointer;
        }
        .image-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-order {
            position: absolute;
            top: -8px;
            left: -8px;
            background: #10B981;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid white;
        }
    </style>
</head>
<body class="text-white">
    <div class="container mx-auto max-w-md px-4 py-8">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold mb-2">ğŸ› íœ ë³µì› AI ì‡¼ì¸  ì œì‘ê¸°</h1>
            <p class="text-gray-400">íœ  ì‘ì—… ì‚¬ì§„ìœ¼ë¡œ ì „ë¬¸ í™ë³´ ì‡¼ì¸ ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
        </div>

        <!-- API í‚¤ ì…ë ¥ -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <label class="block text-sm font-medium mb-3 text-gray-300">
                ğŸ”‘ Google Gemini API í‚¤
            </label>
            <input 
                type="password" 
                id="apiKey" 
                placeholder="Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                class="w-full px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500"
            >
            <p class="text-xs text-gray-500 mt-2">
                API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </p>
        </div>

        <!-- íœ  ì‘ì—… íƒ€ì… ì„ íƒ -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <label class="block text-sm font-medium mb-3 text-gray-300">
                ğŸ› íœ  ì‘ì—… íƒ€ì… ì„ íƒ
            </label>
            <select id="industrySelect" class="w-full px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500">
                <option value="">íœ  ì‘ì—… íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="wheel-restoration">ğŸ› íœ  ë³µì› (ìŠ¤í¬ë˜ì¹˜, ì°Œê·¸ëŸ¬ì§)</option>
                <option value="wheel-repair">ğŸ”§ íœ  ë¦¬í˜ì–´ (ê· ì—´, íœ¨ ìˆ˜ì •)</option>
                <option value="wheel-painting">ğŸ¨ íœ  ë„ìƒ‰ (ì»¬ëŸ¬ ë³€ê²½)</option>
                <option value="wheel-custom">âœ¨ íœ  ì»¤ìŠ¤í„°ë§ˆì´ì§•</option>
                <option value="wheel-polishing">ğŸ’ íœ  í´ë¦¬ì‹± (ê´‘íƒ)</option>
                <option value="wheel-chrome">ğŸŒŸ íœ  í¬ë¡¬ ë„ê¸ˆ</option>
                <option value="wheel-refinish">ğŸ”„ íœ  ë¦¬í”¼ë‹ˆì‹œ</option>
                <option value="other">ğŸ› ï¸ ê¸°íƒ€ íœ  ì‘ì—…</option>
            </select>
        </div>

        <!-- íœ  ëª¨ë¸ëª… ì…ë ¥ -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <label class="block text-sm font-medium mb-3 text-gray-300">
                ğŸ·ï¸ íœ  ëª¨ë¸ëª… ë˜ëŠ” ì‘ì—… ì„¤ëª…
            </label>
            <input 
                type="text" 
                id="productName" 
                placeholder="ì˜ˆ: BMW 18ì¸ì¹˜ ì•Œë¡œì´ íœ , ì†Œë‚˜íƒ€ íœ  ìŠ¤í¬ë˜ì¹˜ ë³µì›"
                class="w-full px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500"
            >
        </div>

        <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <label class="block text-sm font-medium mb-3 text-gray-300">
                ğŸ› íœ  ì‘ì—… ì‚¬ì§„ ì—…ë¡œë“œ (3-10ì¥)
            </label>
            <input 
                type="file" 
                id="imageInput" 
                multiple 
                accept="image/*"
                class="w-full px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
            >
            
            <!-- ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
            <div id="imagePreview" class="hidden mt-4">
                <div class="flex flex-wrap gap-2" id="imageContainer"></div>
            </div>
        </div>

        <!-- ë¶„ì„ ì‹œì‘ ë²„íŠ¼ -->
        <button 
            id="startAnalysis" 
            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed mb-6"
            disabled
        >
            ğŸš€ AI ë¶„ì„ ì‹œì‘
        </button>

        <!-- ìƒíƒœ í‘œì‹œ -->
        <div id="status" class="bg-gray-800 rounded-lg p-4 text-center text-gray-300 hidden">
            ì¤€ë¹„ ì¤‘...
        </div>

        <!-- ë¶„ì„ ê²°ê³¼ -->
        <div id="results" class="hidden bg-gray-800 rounded-lg p-4 mt-6">
            <h3 class="text-lg font-bold mb-4">ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <script type="module">
        let uploadedImages = [];
        let analysisResults = [];

        const apiKeyInput = document.getElementById('apiKey');
        const industrySelect = document.getElementById('industrySelect');
        const productNameInput = document.getElementById('productName');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const imageContainer = document.getElementById('imageContainer');
        const startAnalysisBtn = document.getElementById('startAnalysis');
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        const resultContent = document.getElementById('resultContent');

        // íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
        imageInput.addEventListener('change', handleFileUpload);
        
        // ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        [apiKeyInput, industrySelect, productNameInput].forEach(input => {
            input.addEventListener('change', updateButtonState);
            input.addEventListener('input', updateButtonState);
        });

        // ë¶„ì„ ì‹œì‘ ë²„íŠ¼ í´ë¦­
        startAnalysisBtn.addEventListener('click', startAnalysis);

        function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            
            if (files.length < 3 || files.length > 10) {
                showStatus('âŒ ì´ë¯¸ì§€ëŠ” 3ì¥ ì´ìƒ 10ì¥ ì´í•˜ë¡œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            uploadedImages = [];
            imageContainer.innerHTML = '';

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageData = {
                        name: file.name,
                        dataUrl: e.target.result,
                        file: file
                    };
                    
                    uploadedImages.push(imageData);

                    // ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                    const thumbDiv = document.createElement('div');
                    thumbDiv.className = 'image-thumb';
                    thumbDiv.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <div class="image-order">${index + 1}</div>
                    `;
                    imageContainer.appendChild(thumbDiv);

                    if (uploadedImages.length === files.length) {
                        imagePreview.classList.remove('hidden');
                        updateButtonState();
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function updateButtonState() {
            const hasApiKey = apiKeyInput.value.trim().length > 0;
            const hasIndustry = industrySelect.value.trim().length > 0;
            const hasProductName = productNameInput.value.trim().length > 0;
            const hasImages = uploadedImages.length >= 3;

            startAnalysisBtn.disabled = !(hasApiKey && hasIndustry && hasProductName && hasImages);
        }

        function showStatus(message) {
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
        }

        async function startAnalysis() {
            try {
                startAnalysisBtn.disabled = true;
                showStatus('ğŸ” ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘...');

                const apiKey = apiKeyInput.value.trim();
                const industry = industrySelect.value;
                const productName = productNameInput.value.trim();

                // ê° ì´ë¯¸ì§€ ë¶„ì„
                analysisResults = [];
                
                for (let i = 0; i < uploadedImages.length; i++) {
                    showStatus(`ğŸ” ì´ë¯¸ì§€ ${i + 1}/${uploadedImages.length} ë¶„ì„ ì¤‘...`);
                    
                    const imageData = uploadedImages[i];
                    const base64Data = imageData.dataUrl.split(',')[1];
                    
                    const analysis = await analyzeImageWithGemini(apiKey, base64Data, industry, productName);
                    analysisResults.push({
                        image: imageData,
                        analysis: analysis
                    });
                }

                // ì „ì²´ ìŠ¤í† ë¦¬ ìƒì„±
                showStatus('ğŸ“ ìŠ¤í† ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...');
                const story = await generateStoryWithGemini(apiKey, analysisResults, industry, productName);

                // ê²°ê³¼ í‘œì‹œ
                displayResults(story);
                showStatus('âœ… ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');

            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                showStatus(`âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                startAnalysisBtn.disabled = false;
            }
        }

        async function analyzeImageWithGemini(apiKey, base64Image, industry, productName) {
            const prompt = `íœ ë³µì› ì „ë¬¸ê°€ì˜ ê´€ì ì—ì„œ ì´ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.

ì‘ì—… íƒ€ì…: ${industry}
ì œí’ˆëª…: ${productName}

ë‹¤ìŒ í•­ëª©ë“¤ì„ ë¶„ì„í•´ì£¼ì„¸ìš”:
1. íœ ì˜ ìƒíƒœ (ì†ìƒ ì •ë„, íƒ€ì… ë“±)
2. ì‘ì—… ë‹¨ê³„ (ì‘ì—… ì „/ì¤‘/í›„)
3. ì£¼ìš” íŠ¹ì§• ë° ë³€í™”
4. ì „ë¬¸ì ì¸ ê´€ì°° ë‚´ìš©

JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
  "condition": "íœ  ìƒíƒœ ì„¤ëª…",
  "stage": "ì‘ì—… ë‹¨ê³„",
  "features": "ì£¼ìš” íŠ¹ì§•",
  "professional_notes": "ì „ë¬¸ê°€ ì˜ê²¬"
}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [
                            { text: prompt },
                            {
                                inline_data: {
                                    mime_type: "image/jpeg",
                                    data: base64Image
                                }
                            }
                        ]
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`Gemini API ì˜¤ë¥˜: ${response.status}`);
            }

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            
            try {
                return JSON.parse(text);
            } catch {
                return { analysis: text };
            }
        }

        async function generateStoryWithGemini(apiKey, analysisResults, industry, productName) {
            const analysisText = analysisResults.map((result, index) => 
                `ì´ë¯¸ì§€ ${index + 1}: ${JSON.stringify(result.analysis)}`
            ).join('\n\n');

            const prompt = `íœ ë³µì› ì „ë¬¸ì—…ì²´ì˜ SNS í™ë³´ìš© ì‡¼ì¸  ì˜ìƒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

ì‘ì—… íƒ€ì…: ${industry}
ì œí’ˆëª…: ${productName}

ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼:
${analysisText}

30ì´ˆ ë¶„ëŸ‰ì˜ ë§¤ë ¥ì ì¸ ìŠ¤í† ë¦¬ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”:
1. ì„íŒ©íŠ¸ ìˆëŠ” ì‹œì‘
2. ì‘ì—… ê³¼ì •ì˜ ì „ë¬¸ì„± ê°•ì¡°
3. ê²°ê³¼ì˜ ë§Œì¡±ê°
4. í–‰ë™ ìœ ë„ ë§ˆë¬´ë¦¬

ê° ì´ë¯¸ì§€ë³„ë¡œ 5-7ì´ˆì”© í• ë‹¹í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: prompt }]
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`Gemini API ì˜¤ë¥˜: ${response.status}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        function displayResults(story) {
            resultContent.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-gray-700 rounded p-4">
                        <h4 class="font-bold text-green-400 mb-2">ğŸ“ ìƒì„±ëœ ìŠ¤í† ë¦¬</h4>
                        <pre class="whitespace-pre-wrap text-sm">${story}</pre>
                    </div>
                    
                    <div class="bg-gray-700 rounded p-4">
                        <h4 class="font-bold text-blue-400 mb-2">ğŸ” ì´ë¯¸ì§€ë³„ ë¶„ì„</h4>
                        ${analysisResults.map((result, index) => `
                            <div class="mb-3 p-3 bg-gray-600 rounded">
                                <div class="font-semibold">ì´ë¯¸ì§€ ${index + 1}: ${result.image.name}</div>
                                <div class="text-sm mt-1">${JSON.stringify(result.analysis, null, 2)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            resultsDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>