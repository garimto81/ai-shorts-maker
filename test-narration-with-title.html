<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œëª© ê¸°ë°˜ AI ë‚˜ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading { display: none; }
        .loading.show { display: block; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <h1 class="text-3xl font-bold text-center mb-6 text-purple-600">
                ğŸ™ï¸ ì œëª© ê¸°ë°˜ AI ë‚˜ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸
            </h1>
            <p class="text-center text-gray-600 mb-8">
                íœ  ë³µì› ì „ë¬¸ AIê°€ ì œëª©ì„ ë¶„ì„í•´ì„œ ë§ì¶¤í˜• ë‚˜ë ˆì´ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤
            </p>
            
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- ì…ë ¥ ì„¹ì…˜ -->
                <div class="space-y-6">
                    <div class="bg-purple-50 rounded-lg p-4">
                        <h2 class="text-xl font-semibold mb-4 text-purple-800">ğŸ“ ì œí’ˆ ì •ë³´ ì…ë ¥</h2>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                ì œí’ˆ ì œëª© (ì°¨ì¢…/íœ  ì •ë³´):
                            </label>
                            <input 
                                type="text" 
                                id="productTitle" 
                                value="ë²¤ì¸  Sí´ë˜ìŠ¤ 20ì¸ì¹˜ OZ Racing íœ  ë³µì›"
                                placeholder="ì˜ˆ: BMW 5ì‹œë¦¬ì¦ˆ 19ì¸ì¹˜ BBS íœ  ë³µì›"
                                class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                            <p class="text-xs text-gray-500 mt-1">
                                AIê°€ ë¸Œëœë“œ, ì°¨ì¢…, íœ  ì •ë³´ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤
                            </p>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                íœ  ì´ë¯¸ì§€ ì„ íƒ (ìµœì†Œ 2ì¥):
                            </label>
                            <input 
                                type="file" 
                                id="wheelImages" 
                                accept="image/*" 
                                multiple 
                                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100"
                            >
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ì´ë¯¸ì§€ ì§€ì†ì‹œê°„:
                                </label>
                                <input 
                                    type="number" 
                                    id="imageDuration" 
                                    value="3" 
                                    min="2" 
                                    max="6" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                >
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ë‚˜ë ˆì´ì…˜ ì†ë„:
                                </label>
                                <select id="narrationSpeed" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <option value="3">ëŠë¦¼ (3ì/ì´ˆ)</option>
                                    <option value="4" selected>ë³´í†µ (4ì/ì´ˆ)</option>
                                    <option value="5">ë¹ ë¦„ (5ì/ì´ˆ)</option>
                                </select>
                            </div>
                        </div>

                        <button 
                            onclick="generateNarrationVideo()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-lg hover:from-purple-700 hover:to-blue-700 transition duration-200 font-semibold text-lg"
                        >
                            ğŸ¬ AI ë‚˜ë ˆì´ì…˜ ë¹„ë””ì˜¤ ìƒì„±
                        </button>
                    </div>

                    <!-- ì œëª© ë¶„ì„ ê²°ê³¼ -->
                    <div id="titleAnalysis" class="hidden bg-green-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-green-800 mb-3">ğŸ” ì œëª© ë¶„ì„ ê²°ê³¼</h3>
                        <div id="analysisContent" class="space-y-2 text-sm"></div>
                    </div>
                </div>

                <!-- ê²°ê³¼ ì„¹ì…˜ -->
                <div class="space-y-6">
                    <!-- ë¡œë”© ìƒíƒœ -->
                    <div id="loading" class="loading text-center py-8">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mb-4"></div>
                        <p class="text-gray-600 text-lg">AI ë‚˜ë ˆì´ì…˜ ìƒì„± ì¤‘...</p>
                        <div id="progressText" class="text-sm text-gray-500 mt-2"></div>
                        <div class="mt-4 space-y-2">
                            <div class="text-xs text-gray-400">ğŸ” ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...</div>
                            <div class="text-xs text-gray-400">ğŸ™ï¸ ë§ì¶¤ ë‚˜ë ˆì´ì…˜ ìƒì„± ì¤‘...</div>
                            <div class="text-xs text-gray-400">ğŸµ AI ìŒì„± í•©ì„± ì¤‘...</div>
                            <div class="text-xs text-gray-400">âœ¨ í˜ì´ë“œ ì „í™˜ íš¨ê³¼ ì ìš© ì¤‘...</div>
                            <div class="text-xs text-gray-400">ğŸ¬ ë¹„ë””ì˜¤ í¸ì§‘ ì¤‘...</div>
                        </div>
                    </div>

                    <!-- ê²°ê³¼ í‘œì‹œ -->
                    <div id="result" class="hidden">
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“Š ìƒì„± ê²°ê³¼</h3>
                            <pre id="resultText" class="text-sm bg-white p-4 rounded-lg border overflow-x-auto mb-4"></pre>
                            
                            <div id="downloadSection" class="hidden">
                                <a id="downloadLink" href="#" download class="inline-block bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 px-6 rounded-lg hover:from-green-600 hover:to-blue-600 transition duration-200 font-semibold">
                                    ğŸ“¥ ë‚˜ë ˆì´ì…˜ ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œ
                                </a>
                                <div class="mt-3 text-sm text-gray-600">
                                    <span class="inline-block mr-4">ğŸ™ï¸ <span id="audioStatus">ìŒì„± í¬í•¨</span></span>
                                    <span class="inline-block">â±ï¸ ì²˜ë¦¬ì‹œê°„: <span id="processingTime">-</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ìƒ˜í”Œ ì œëª©ë“¤ -->
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-blue-800 mb-3">ğŸ’¡ ìƒ˜í”Œ ì œëª©ë“¤</h3>
                        <div class="space-y-2 text-sm">
                            <button onclick="setTitle('í¬ë¥´ì‰ 911 í„°ë³´ 20ì¸ì¹˜ BBS íœ  ë³µì›')" class="block w-full text-left px-3 py-2 bg-white rounded border hover:bg-gray-50">
                                í¬ë¥´ì‰ 911 í„°ë³´ 20ì¸ì¹˜ BBS íœ  ë³µì›
                            </button>
                            <button onclick="setTitle('BMW M3 19ì¸ì¹˜ Enkei RPF1 íœ  ë³µì›')" class="block w-full text-left px-3 py-2 bg-white rounded border hover:bg-gray-50">
                                BMW M3 19ì¸ì¹˜ Enkei RPF1 íœ  ë³µì›
                            </button>
                            <button onclick="setTitle('ì•„ìš°ë”” A8 21ì¸ì¹˜ OZ Racing íœ  ë³µì›')" class="block w-full text-left px-3 py-2 bg-white rounded border hover:bg-gray-50">
                                ì•„ìš°ë”” A8 21ì¸ì¹˜ OZ Racing íœ  ë³µì›
                            </button>
                            <button onclick="setTitle('ëŒë³´ë¥´ê¸°ë‹ˆ ìš°ë¼ì¹¸ Vossen í¬ì§€ë“œ íœ  ë³µì›')" class="block w-full text-left px-3 py-2 bg-white rounded border hover:bg-gray-50">
                                ëŒë³´ë¥´ê¸°ë‹ˆ ìš°ë¼ì¹¸ Vossen í¬ì§€ë“œ íœ  ë³µì›
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function setTitle(title) {
            document.getElementById('productTitle').value = title;
            analyzeTitle(title);
        }

        function analyzeTitle(title = null) {
            const titleText = title || document.getElementById('productTitle').value;
            if (!titleText) return;

            // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì œëª© ë¶„ì„ (ë¯¸ë¦¬ë³´ê¸°)
            const analysis = {
                brand: 'ë¯¸ë¶„ì„',
                category: 'ë¯¸ë¶„ì„', 
                wheelBrand: 'ë¯¸ë¶„ì„',
                size: 'ë¯¸í™•ì¸'
            };

            // ê°„ë‹¨í•œ ë¸Œëœë“œ ë§¤ì¹­
            if (titleText.includes('ë²¤ì¸ ')) analysis.brand = 'ë©”ë¥´ì„¸ë°ìŠ¤-ë²¤ì¸ ';
            else if (titleText.includes('BMW') || titleText.includes('bmw')) analysis.brand = 'BMW';
            else if (titleText.includes('í¬ë¥´ì‰')) analysis.brand = 'í¬ë¥´ì‰';
            else if (titleText.includes('ì•„ìš°ë””')) analysis.brand = 'ì•„ìš°ë””';
            else if (titleText.includes('ëŒë³´ë¥´ê¸°ë‹ˆ')) analysis.brand = 'ëŒë³´ë¥´ê¸°ë‹ˆ';

            if (titleText.includes('BBS') || titleText.includes('bbs')) analysis.wheelBrand = 'BBS';
            else if (titleText.includes('OZ') || titleText.includes('oz')) analysis.wheelBrand = 'OZ Racing';
            else if (titleText.includes('Enkei') || titleText.includes('enkei')) analysis.wheelBrand = 'ENKEI';
            else if (titleText.includes('Vossen') || titleText.includes('vossen')) analysis.wheelBrand = 'Vossen';

            const sizeMatch = titleText.match(/(\d{2})\s*ì¸ì¹˜/);
            if (sizeMatch) analysis.size = sizeMatch[1] + 'ì¸ì¹˜';

            // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
            const analysisDiv = document.getElementById('titleAnalysis');
            const contentDiv = document.getElementById('analysisContent');
            
            contentDiv.innerHTML = `
                <div><span class="font-semibold">ğŸš— ì°¨ëŸ‰ ë¸Œëœë“œ:</span> ${analysis.brand}</div>
                <div><span class="font-semibold">â­• íœ  ë¸Œëœë“œ:</span> ${analysis.wheelBrand}</div>
                <div><span class="font-semibold">ğŸ“ íœ  í¬ê¸°:</span> ${analysis.size}</div>
                <div class="text-green-600 font-medium mt-2">â†’ AIê°€ ì´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì¸ ë‚˜ë ˆì´ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤</div>
            `;
            
            analysisDiv.classList.remove('hidden');
        }

        async function generateNarrationVideo() {
            const fileInput = document.getElementById('wheelImages');
            const productTitle = document.getElementById('productTitle').value;
            const duration = document.getElementById('imageDuration').value;
            const speed = document.getElementById('narrationSpeed').value;
            
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const resultText = document.getElementById('resultText');
            const downloadSection = document.getElementById('downloadSection');
            const downloadLink = document.getElementById('downloadLink');
            const audioStatus = document.getElementById('audioStatus');

            if (!fileInput.files || fileInput.files.length < 2) {
                alert('ìµœì†Œ 2ì¥ì˜ íœ  ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!productTitle.trim()) {
                alert('ì œí’ˆ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: BMW M3 19ì¸ì¹˜ BBS íœ )');
                return;
            }

            loading.classList.add('show');
            result.classList.add('hidden');

            const formData = new FormData();
            
            for (let i = 0; i < fileInput.files.length; i++) {
                formData.append('images', fileInput.files[i]);
            }
            
            formData.append('productTitle', productTitle);
            formData.append('duration', duration);
            formData.append('narrationSpeed', speed);

            try {
                console.log('ğŸ™ï¸ ì œëª© ê¸°ë°˜ ë‚˜ë ˆì´ì…˜ ë¹„ë””ì˜¤ ìƒì„± ì‹œì‘');
                console.log('ì œí’ˆ ì œëª©:', productTitle);
                
                const startTime = Date.now();
                const response = await fetch('/api/test-video-with-narration', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                const processingTime = Math.round((Date.now() - startTime) / 1000);
                
                loading.classList.remove('show');
                result.classList.remove('hidden');

                if (data.success) {
                    resultText.textContent = JSON.stringify({
                        status: 'âœ… ì„±ê³µ',
                        ì œëª©: productTitle,
                        íŒŒì¼ëª…: data.filename,
                        ìŒì„±í¬í•¨: data.hasAudio ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤',
                        ì²˜ë¦¬ì‹œê°„: processingTime + 'ì´ˆ',
                        ë©”ì‹œì§€: data.message
                    }, null, 2);

                    if (data.downloadUrl) {
                        downloadLink.href = data.downloadUrl;
                        downloadSection.classList.remove('hidden');
                        audioStatus.textContent = data.hasAudio ? 'âœ… AI ìŒì„± í¬í•¨' : 'âŒ ìŒì„± ìƒì„± ì‹¤íŒ¨';
                        document.getElementById('processingTime').textContent = processingTime + 'ì´ˆ';
                    }
                } else {
                    resultText.textContent = JSON.stringify({
                        status: 'âŒ ì‹¤íŒ¨',
                        ì˜¤ë¥˜: data.error,
                        ìƒì„¸: data.details
                    }, null, 2);
                }

            } catch (error) {
                loading.classList.remove('show');
                result.classList.remove('hidden');
                
                resultText.textContent = JSON.stringify({
                    status: 'âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜',
                    ì˜¤ë¥˜: error.message
                }, null, 2);

                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
            }
        }

        // ì œí’ˆ ì œëª© ì‹¤ì‹œê°„ ë¶„ì„
        document.getElementById('productTitle').addEventListener('input', function(e) {
            if (e.target.value.length > 3) {
                analyzeTitle();
            }
        });

        // íŒŒì¼ ì„ íƒ ì‹œ ì •ë³´ í‘œì‹œ
        document.getElementById('wheelImages').addEventListener('change', function(e) {
            const fileCount = e.target.files.length;
            if (fileCount > 0) {
                console.log(`${fileCount}ê°œ íœ  ì´ë¯¸ì§€ ì„ íƒë¨`);
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì œëª© ë¶„ì„
        window.addEventListener('load', function() {
            analyzeTitle();
        });
    </script>
</body>
</html>